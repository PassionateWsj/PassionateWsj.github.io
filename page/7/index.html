<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="简单即快乐。">
<meta property="og:type" content="website">
<meta property="og:title" content="JamesWong&#39;s Notes">
<meta property="og:url" content="http://yoursite.com/page/7/index.html">
<meta property="og:site_name" content="JamesWong&#39;s Notes">
<meta property="og:description" content="简单即快乐。">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JamesWong&#39;s Notes">
<meta name="twitter:description" content="简单即快乐。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/7/"/>





  <title>JamesWong's Notes</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JamesWong's Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/13/Android源码架构/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JamesWong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JamesWong's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/13/Android源码架构/" itemprop="url">Android源码架构</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-13T22:13:49+08:00">
                2017-03-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Android源码架构"><a href="#Android源码架构" class="headerlink" title="Android源码架构"></a>Android源码架构</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">├── Makefile            全局的Makefile</span><br><span class="line">├── build               系统编译规则和配置所需要的脚本和工具</span><br><span class="line">├── prebuilt            各种平台编译工具链</span><br><span class="line">├── bionic              基础C库源代码</span><br><span class="line">├── frameworks          * Android应用程序的核心框架层(java及C++语言)</span><br><span class="line">├── system              * 底层文件系统/库/应用及组件(adb...)</span><br><span class="line">├── dalvik              JAVA虚拟机</span><br><span class="line">├── external            Android使用的一些额外开源库(字体/Bt/Sepolicy...)</span><br><span class="line">├── libcore             与媒体播放框架代码相关</span><br><span class="line">├── packages            各种应用程序实例</span><br><span class="line">├── development         程序开发所需要的实例/模板/工具</span><br><span class="line">├── ndk</span><br><span class="line">├── sdk</span><br><span class="line">├── cts                 Android CTS兼容性规范测试代码</span><br><span class="line">├── vendor              * 厂商定制代码</span><br><span class="line">├── device              * 厂商定制代码</span><br><span class="line">├── hardware            * 一些与硬件相关的库，部分厂家开源的硬解适配层HAL代码</span><br><span class="line">├── kernel              * Linux源代码</span><br><span class="line">├── bootable            引导加载器（LK）</span><br><span class="line">├── abi</span><br><span class="line">├── doc                 * Android相关的文档</span><br><span class="line">├── art                 * art虚拟机相关的代码</span><br><span class="line">├── developers</span><br><span class="line">├── libnativehelper</span><br><span class="line">├── out                 编译生成的文件</span><br><span class="line">├── pdk</span><br></pre></td></tr></table></figure>
<h1 id="BUILD系统"><a href="#BUILD系统" class="headerlink" title="BUILD系统"></a>BUILD系统</h1><p>Android的源码是如何编译的？<br>了解了这个有助于我们对android源码是如何构成的有直观的了解，现在以SC7731C Android7.0为例，在这里对Android编译系统进行分析。</p>
<p>整个build的make文件主要分为三类:   </p>
<ol>
<li>系统核心的Make文件： 定义了Build系统的框架，文件全部位于路径 /build/core ，其他Make文件都是基于该框架编写的；   </li>
<li>针对产品的Make文件： 定义了具体某个型号手机的Make文件，文件路径位于 /device ，该目录下往往又以公司名和产品名划分两个子级目录，比如 /device/qcom/msm8916 ；  </li>
<li>针对模块的Make文件： 整个系统分为各个独立的模块，每个模块都一个专门的Make文件，名称统一为”Android.mk”，该文件定义了当前模块的编译方式。Build系统会扫描整个源码树中名为”Android.mk”的问题，并执行相应模块的编译工作。  </li>
</ol>
<h2 id="Android编译指令"><a href="#Android编译指令" class="headerlink" title="Android编译指令"></a>Android编译指令</h2><p>Android原生的代码完整编译需要如下三个命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">source</span> build/envsetup.sh</span><br><span class="line">$ lunch</span><br><span class="line">$ make</span><br></pre></td></tr></table></figure></p>
<h3 id="1-source-build-envsetup-sh"><a href="#1-source-build-envsetup-sh" class="headerlink" title="1. source build/envsetup.sh"></a>1. source build/envsetup.sh</h3><blockquote>
<p>第一行命令<code>$ source build/envsetup.sh</code>引入了<code>build/envsetup.sh</code>脚本中的变量和方法，该脚本的作用是初始化编译环境，其中最重要的函数比如lunch就是在这一步加载到shell环境变量中去的。<br>环境导入后,当可以执行lunch函数时，通常有一下命令可被执行。</p>
</blockquote>
<ul>
<li>编译指令</li>
</ul>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>croot</td>
<td>切换到源码树的根目录</td>
</tr>
<tr>
<td>m</td>
<td>在源码树的根目录执行 make</td>
</tr>
<tr>
<td>mm</td>
<td>Build 当前目录下的模块</td>
</tr>
<tr>
<td>mmm</td>
<td>Build 指定目录下的模块</td>
</tr>
<tr>
<td>mma</td>
<td>编译当前路径下所有模块，且包含依赖</td>
</tr>
<tr>
<td>mmma</td>
<td>编译指定路径下所有模块，且包含依赖</td>
</tr>
<tr>
<td>make \<module\></module\></td>
<td>无参数则表示编译整个Android代码</td>
</tr>
</tbody>
</table>
<ul>
<li>搜索指令</li>
</ul>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>cgrep</td>
<td>在所有 C/C++ 文件上执行 grep</td>
</tr>
<tr>
<td>jgrep</td>
<td>在所有 Java 文件上执行 grep</td>
</tr>
<tr>
<td>resgrep</td>
<td>在所有 res/*.xml 文件上执行 grep</td>
</tr>
<tr>
<td>mangrep</td>
<td>所有 AndroidManifest.xml 文件执行搜索操作</td>
</tr>
<tr>
<td>sepgrep</td>
<td>所有 sepolicy 文件执行搜索操作</td>
</tr>
<tr>
<td>sgrep</td>
<td>所有资源文件执行搜索操作</td>
</tr>
</tbody>
</table>
<ul>
<li>导航指令</li>
</ul>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>croot</td>
<td>切换至Android根目录</td>
</tr>
<tr>
<td>cproj</td>
<td>切换至工程的根目录</td>
</tr>
</tbody>
</table>
<blockquote>
<p>可以搭配<code>cd -</code>来回切换</p>
</blockquote>
<ul>
<li>其他指令</li>
</ul>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>printconfig</td>
<td>显示当前 Build 的配置信息</td>
</tr>
<tr>
<td>add_lunch_combo</td>
<td>在 lunch 函数的菜单中添加一个条目</td>
</tr>
<tr>
<td>lunch</td>
<td>函数的参数用来指定此次编译的目标产品以及编译类型。</td>
</tr>
</tbody>
</table>
<p>如下是SC7731C X50142项目source后添加的环境变量:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ANDROID_DEV_SCRIPTS=/home/liujunhong/develop/X50142/idh.code/development/scripts:/home/liujunhong/develop/X50142/idh.code/prebuilts/devtools/tools:/home/liujunhong/develop/X50142/idh.code/external/selinux/prebuilts/bin</span><br><span class="line">ARM_EABI_TOOLCHAIN=/home/liujunhong/develop/X50142/idh.code/prebuilts/gcc/linux-x86/arm/arm-eabi-4.8/bin</span><br><span class="line">ANDROID_PRE_BUILD_PATHS=/usr/lib/jvm/java-8-openjdk-amd64/bin:</span><br><span class="line">ANDROID_BUILD_TOP=/home/liujunhong/develop/X50142/idh.code</span><br><span class="line">ANDROID_PRODUCT_OUT=/home/liujunhong/develop/X50142/idh.code/out/target/product/sp7731c_1h10</span><br><span class="line">ANDROID_JAVA_TOOLCHAIN=/usr/lib/jvm/java-8-openjdk-amd64/bin</span><br><span class="line">OUT=/home/liujunhong/develop/X50142/idh.code/out/target/product/sp7731c_1h10</span><br><span class="line">TARGET_BUILD_VARIANT=userdebug</span><br><span class="line">ASAN_OPTIONS=detect_leaks=0</span><br><span class="line">BUILD_ENV_SEQUENCE_NUMBER=10</span><br><span class="line">ANDROID_BUILD_PATHS=/home/liujunhong/develop/X50142/idh.code/out/host/linux-x86/bin:/home/liujunhong/develop/X50142/idh.code/prebuilts/gcc/linux-x86/arm/arm-linux-androideabi-4.9/bin:/home/liujunhong/develop/X50142/idh.code/prebuilts/gcc/linux-x86/:/home/liujunhong/develop/X50142/idh.code/prebuilts/gcc/linux-x86/arm/arm-eabi-4.8/bin::/home/liujunhong/develop/X50142/idh.code/development/scripts:/home/liujunhong/develop/X50142/idh.code/prebuilts/devtools/tools:/home/liujunhong/develop/X50142/idh.code/external/selinux/prebuilts/bin:/home/liujunhong/develop/X50142/idh.code/prebuilts/android-emulator/linux-x86_64:</span><br><span class="line">TARGET_BUILD_APPS=</span><br><span class="line">TARGET_BUILD_TYPE=release</span><br><span class="line">PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin:/home/liujunhong/develop/X50142/idh.code/out/host/linux-x86/bin:/home/liujunhong/develop/X50142/idh.code/prebuilts/gcc/linux-x86/arm/arm-linux-androideabi-4.9/bin:/home/liujunhong/develop/X50142/idh.code/prebuilts/gcc/linux-x86/:/home/liujunhong/develop/X50142/idh.code/prebuilts/gcc/linux-x86/arm/arm-eabi-4.8/bin::/home/liujunhong/develop/X50142/idh.code/development/scripts:/home/liujunhong/develop/X50142/idh.code/prebuilts/devtools/tools:/home/liujunhong/develop/X50142/idh.code/external/selinux/prebuilts/bin:/home/liujunhong/develop/X50142/idh.code/prebuilts/android-emulator/linux-x86_64:/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/lib/jvm/java-8-openjdk-amd64/jre/bin/:/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/<span class="built_in">local</span>/games:/usr/app/node-v4.5.0-linux-x64/bin:/home/liujunhong/Mydoc/bin</span><br><span class="line">JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64</span><br><span class="line">ANDROID_TOOLCHAIN=/home/liujunhong/develop/X50142/idh.code/prebuilts/gcc/linux-x86/arm/arm-linux-androideabi-4.9/bin</span><br><span class="line">ANDROID_TOOLCHAIN_2ND_ARCH=/home/liujunhong/develop/X50142/idh.code/prebuilts/gcc/linux-x86/</span><br><span class="line">GCC_COLORS=error=01;31:warning=01;35:note=01;36:caret=01;32:locus=01:quote=01</span><br><span class="line">PYTHONPATH=/home/liujunhong/develop/X50142/idh.code/development/python-packages:</span><br><span class="line">ANDROID_EMULATOR_PREBUILTS=/home/liujunhong/develop/X50142/idh.code/prebuilts/android-emulator/linux-x86_64</span><br><span class="line">TARGET_GCC_VERSION=4.9</span><br><span class="line">ANDROID_HOST_OUT=/home/liujunhong/develop/X50142/idh.code/out/host/linux-x86</span><br><span class="line">TARGET_PRODUCT=sp7731c_1h10_oversea</span><br></pre></td></tr></table></figure></p>
<h3 id="2-lunch"><a href="#2-lunch" class="headerlink" title="2. lunch"></a>2. lunch</h3><p>lunch命令用于指定此次编译的目标产品，以下是7731c平台lunch时的输出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">You&apos;re building on Linux</span><br><span class="line">Lunch menu... pick a combo:</span><br><span class="line">     1. aosp_arm-eng</span><br><span class="line">     2. aosp_arm64-eng</span><br><span class="line">     ...</span><br><span class="line">     28. sp7731c_1h10_native-userdebug</span><br><span class="line">     29. sp7731c_1h10_native_trusty-userdebug</span><br><span class="line">     30. sp7731c_1h10_multi-userdebug</span><br><span class="line">     31. sp7731c_1h10_telcel-userdebug</span><br><span class="line">     32. sp7731c_1h10_vodafne-userdebug</span><br><span class="line">     33. sp7731c_1h10_claro-userdebug</span><br><span class="line">     34. sp7731c_1h10_orange-userdebug</span><br><span class="line">     35. sp7731c_1h10_oversea-userdebug</span><br><span class="line">     ...</span><br><span class="line">     46. sp8730se_1h10_qhd_native-userdebug</span><br><span class="line">...</span><br><span class="line">     49. sp8730se_1h10_qhd_native-userdebug</span><br></pre></td></tr></table></figure></p>
<p>这些配置是从哪里获取到的呢？我们就不得不说<code>add_lunch_combo</code>，如上文所说，<code>add_lunch_combo</code>升级是为lunch添加一个条目，而实际就是增加了一种<code>产品配置</code>   </p>
<p>在哪里有调用呢？ </p>
<ul>
<li><code>device/&lt;vendor&gt;/&lt;platform&gt;/&lt;board&gt;/vendorsetup.sh</code>，以下是我们SC7731C平台的代码文件<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">idh.code\device\sprd\scx20\sp7731c_1h10\vendorsetup.sh  </span><br><span class="line">add_lunch_combo sp7731c_1h10_native-userdebug</span><br><span class="line">add_lunch_combo sp7731c_1h10_native_trusty-userdebug</span><br><span class="line">add_lunch_combo sp7731c_1h10_multi-userdebug</span><br><span class="line">add_lunch_combo sp7731c_1h10_telcel-userdebug</span><br><span class="line">add_lunch_combo sp7731c_1h10_vodafne-userdebug</span><br><span class="line">add_lunch_combo sp7731c_1h10_claro-userdebug</span><br><span class="line">add_lunch_combo sp7731c_1h10_orange-userdebug</span><br><span class="line">add_lunch_combo sp7731c_1h10_oversea-userdebug</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>我们看看<code>add_lunch_combo</code>和<code>lunch</code>的代码可以知道,<code>add_lunch_combo</code>会将后面的参数去重后放到一个数组中<br>而<code>lunch</code>时只是先显示该数组的内容,然后根据用户的选择来设置并显示了一些环境变量然后显示<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> add_lunch_combo()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">local</span> new_combo=<span class="variable">$1</span></span><br><span class="line">    <span class="built_in">local</span> c</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="variable">$&#123;LUNCH_MENU_CHOICES[@]&#125;</span> ; <span class="keyword">do</span>  </span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">"<span class="variable">$new_combo</span>"</span> = <span class="string">"<span class="variable">$c</span>"</span> ] ; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">return</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    LUNCH_MENU_CHOICES=(<span class="variable">$&#123;LUNCH_MENU_CHOICES[@]&#125;</span> <span class="variable">$new_combo</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> lunch()</span><br><span class="line">&#123;</span><br><span class="line">....</span><br><span class="line">        print_lunch_menu</span><br><span class="line">        &lt;CODE FOR PARSE USER CHOOSE&gt;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    <span class="built_in">export</span> TARGET_PRODUCT=<span class="variable">$product</span></span><br><span class="line">    <span class="built_in">export</span> TARGET_BUILD_VARIANT=<span class="variable">$variant</span></span><br><span class="line">    <span class="built_in">export</span> TARGET_BUILD_TYPE=release</span><br><span class="line">...</span><br><span class="line">    set_stuff_for_environment</span><br><span class="line">    printconfig</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>那编译系统是在什么时候去读取的<code>vendorsetup.sh</code>文件呢? </p>
<ul>
<li>在<code>envsetup.sh</code>的最后,脚本会变量device目录,找到所有的<code>vendorsetup.sh</code>文件<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ <span class="string">"x<span class="variable">$SHELL</span>"</span> != <span class="string">"x/bin/bash"</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">case</span> `ps -o <span class="built_in">command</span> -p $$` <span class="keyword">in</span></span><br><span class="line">        *bash*)</span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"WARNING: Only bash is supported, use of other shell would lead to erroneous results"</span></span><br><span class="line">            ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Execute the contents of any vendorsetup.sh files we can find.</span></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> `<span class="built_in">test</span> -d device &amp;&amp; find -L device -maxdepth 4 -name <span class="string">'vendorsetup.sh'</span> 2&gt; /dev/null | sort` \</span><br><span class="line">         `<span class="built_in">test</span> -d vendor &amp;&amp; find -L vendor -maxdepth 4 -name <span class="string">'vendorsetup.sh'</span> 2&gt; /dev/null | sort` \</span><br><span class="line">         `<span class="built_in">test</span> -d product &amp;&amp; find -L product -maxdepth 4 -name <span class="string">'vendorsetup.sh'</span> 2&gt; /dev/null | sort`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"including <span class="variable">$f</span>"</span></span><br><span class="line">    . <span class="variable">$f</span> <span class="comment">#运行找到的脚本(注意是用". "来运行的,相当与source vendorsetup.sh)</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">unset</span> f</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>因为我们在<code>add_lunch_combo</code>的时候默认的<code>varient</code>是<code>userdebug</code>,如果我们需要编译其他类型的版本,我们还需要使用<code>choosevariant</code>来选择我们需要编译的版本类型<br>variant通常有三种:   </p>
<ul>
<li>user:代表这是编译出的系统镜像是可以用来正式发布到市场的版本,其权限是被限制的(如没有root权限等)</li>
<li>userdebug:在user版本的基础上开放了root权限和debug权限.</li>
<li>eng:代表engineer,也就是所谓的开发工程师的版本,拥有最大的权限(root等),此外还附带了许多debug工具</li>
</ul>
<h3 id="3-make"><a href="#3-make" class="headerlink" title="3. make"></a>3. make</h3><h4 id="3-1-编译目标"><a href="#3-1-编译目标" class="headerlink" title="3.1 编译目标"></a>3.1 编译目标</h4><p>当我们在Android源码根目录下执行make的时候，会查找当前目录下的Makefie文件或者makefile文件并且执行，在android/Makefile文件中，它只有一行有用的内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">### DO NOT EDIT THIS FILE ###</span><br><span class="line">include build/core/main.mk</span><br><span class="line">### DO NOT EDIT THIS FILE ###</span><br></pre></td></tr></table></figure></p>
<p>因此，执行make时真正的入口是android/build/core/main.mk文件<br>我们在Android源码根目录下执行make命令的时候，并没有传入目标，那么就会执行默认的目标。那默认的目标是什么呢？在android/build/core/main.mk中有这样几行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># This is the default target.  It must be the first declared target.</span><br><span class="line">.PHONY: droid</span><br><span class="line">DEFAULT_GOAL := droid</span><br><span class="line">$(DEFAULT_GOAL): droid_targets</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Building a full system-- the default is to build droidcore</span><br><span class="line">droid_targets: droidcore dist_files</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Build files and then package it into the rom formats</span><br><span class="line">.PHONY: droidcore</span><br><span class="line">droidcore: files \</span><br><span class="line">	systemimage \</span><br><span class="line">	$(INSTALLED_BOOTIMAGE_TARGET) \</span><br><span class="line">	$(INSTALLED_RECOVERYIMAGE_TARGET) \</span><br><span class="line">	$(INSTALLED_USERDATAIMAGE_TARGET) \</span><br><span class="line">	$(INSTALLED_CACHEIMAGE_TARGET) \</span><br><span class="line">	$(INSTALLED_PRODNVIMAGE_TARGET) \</span><br><span class="line">	$(INSTALLED_VENDORIMAGE_TARGET) \</span><br><span class="line">	$(INSTALLED_FILES_FILE) \</span><br><span class="line">	$(INSTALLED_FILES_FILE_VENDOR)</span><br></pre></td></tr></table></figure>
<p>可以看到默认的目标是<code>droid</code>,而<code>droid</code>又依赖<code>droid_targets</code>,<code>droid_targets</code>又依赖<code>droidcore</code> 和 <code>dist_files</code>,然后<code>droidcore</code>依赖的就是各类images</p>
<p><img src="&quot;图片来源:http://blog.csdn.net/lizekun2010/article/details/52598105&quot;" alt="targets.png"></p>
<h4 id="3-2-其他-Make-命令"><a href="#3-2-其他-Make-命令" class="headerlink" title="3.2 其他 Make 命令"></a>3.2 其他 Make 命令</h4><table>
<thead>
<tr>
<th>Make 目标</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>make clean</td>
<td>执行清理，等同于：rm -rf out/。</td>
</tr>
<tr>
<td>make sdk</td>
<td>编译出 Android 的 SDK。</td>
</tr>
<tr>
<td>make clean-sdk</td>
<td>清理 SDK 的编译产物。</td>
</tr>
<tr>
<td>make update-api</td>
<td>更新 API。在 framework API 改动之后，需要首先执行该命令来更新 API，公开的 API 记录在 frameworks/base/api 目录下。</td>
</tr>
<tr>
<td>make dist</td>
<td>执行 Build，并将 MAKECMDGOALS 变量定义的输出文件拷贝到 /out/dist 目录。</td>
</tr>
<tr>
<td>make all</td>
<td>编译所有内容，不管当前产品的定义中是否会包含。</td>
</tr>
<tr>
<td>make help</td>
<td>帮助信息，显示主要的 make 目标。</td>
</tr>
<tr>
<td>make snod</td>
<td>从已经编译出的包快速重建系统镜像。（其实主要对system进行打包）</td>
</tr>
<tr>
<td></td>
<td>make snod  — system.i</td>
</tr>
<tr>
<td>make libandroid_runtime</td>
<td>编译所有 JNI framework 内容。</td>
</tr>
<tr>
<td>make framework</td>
<td>编译所有 Java framework 内容。</td>
</tr>
<tr>
<td>make services</td>
<td>编译系统服务和相关内容。</td>
</tr>
<tr>
<td>make <local_target></local_target></td>
<td>编译一个指定的模块，local_target 为模块的名称。</td>
</tr>
<tr>
<td>make clean-<local_target></local_target></td>
<td>清理一个指定模块的编译结果。</td>
</tr>
<tr>
<td>make dump-products</td>
<td>显示所有产品的编译配置信息，例如：产品名，产品支持的地区语言，产品中会包含的模块等信息。</td>
</tr>
<tr>
<td>make bootimage</td>
<td>生成 boot.img</td>
</tr>
<tr>
<td>make recoveryimage</td>
<td>生成 recovery.img</td>
</tr>
<tr>
<td>make userdataimage</td>
<td>生成 userdata.img</td>
</tr>
<tr>
<td>make cacheimage</td>
<td>生成 cache.img</td>
</tr>
</tbody>
</table>
<h2 id="3-2-编译流程"><a href="#3-2-编译流程" class="headerlink" title="3.2 编译流程"></a>3.2 编译流程</h2><blockquote>
<p>main.mk –&gt; config.mk –&gt; envsetup.mk –&gt; product_config.mk      </p>
</blockquote>
<p>下面就来看看<code>product_config.mk</code>文件，首先调用方法get-all-product-makefiles找出所有的AndoridProducts.mk文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ifneq ($(strip $(TARGET_BUILD_APPS)),)</span><br><span class="line"># An unbundled app build needs only the core product makefiles.</span><br><span class="line">all_product_configs := $(call get-product-makefiles,\</span><br><span class="line">    $(SRC_TARGET_DIR)/product/AndroidProducts.mk)</span><br><span class="line">else</span><br><span class="line"># Read in all of the product definitions specified by the AndroidProducts.mk</span><br><span class="line"># files in the tree.</span><br><span class="line">all_product_configs := $(get-all-product-makefiles)</span><br><span class="line">endif</span><br></pre></td></tr></table></figure>
<p>然后从all_product_configs中找出我们当前产品的all_product_makefiles文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># Find the product config makefile for the current product.</span><br><span class="line"># all_product_configs consists items like:</span><br><span class="line"># &lt;product_name&gt;:&lt;path_to_the_product_makefile&gt;</span><br><span class="line"># or just &lt;path_to_the_product_makefile&gt; in case the product name is the</span><br><span class="line"># same as the base filename of the product config makefile.</span><br><span class="line">current_product_makefile :=</span><br><span class="line">all_product_makefiles :=</span><br><span class="line">$(foreach f, $(all_product_configs),\</span><br><span class="line">    $(eval _cpm_words := $(subst :,$(space),$(f)))\</span><br><span class="line">    $(eval _cpm_word1 := $(word 1,$(_cpm_words)))\</span><br><span class="line">    $(eval _cpm_word2 := $(word 2,$(_cpm_words)))\</span><br><span class="line">    $(if $(_cpm_word2),\</span><br><span class="line">        $(eval all_product_makefiles += $(_cpm_word2))\</span><br><span class="line">        $(if $(filter $(TARGET_PRODUCT),$(_cpm_word1)),\</span><br><span class="line">            $(eval current_product_makefile += $(_cpm_word2)),),\</span><br><span class="line">        $(eval all_product_makefiles += $(f))\</span><br><span class="line">        $(if $(filter $(TARGET_PRODUCT),$(basename $(notdir $(f)))),\</span><br><span class="line">            $(eval current_product_makefile += $(f)),)))</span><br><span class="line">_cpm_words :=</span><br><span class="line">_cpm_word1 :=</span><br><span class="line">_cpm_word2 :=</span><br><span class="line">current_product_makefile := $(strip $(current_product_makefile))</span><br></pre></td></tr></table></figure></p>
<p>比如我们在执行lunch时选择的是sp7731c_1h10_oversea，则current_product_makefile的值就是：device/sprd/scx20/sp7731c_1h10/sp7731c_1h10_oversea.mk<br>接着调用import-products导入产品配置信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(call import-products, $(current_product_makefile))</span><br></pre></td></tr></table></figure></p>
<p>接着设置TARGET_DEVICE的值，其实就是sp7731c_1h10：<br>TARGET_DEVICE := $(PRODUCTS.$(INTERNAL_PRODUCT).PRODUCT_DEVICE)<br>接着设置PRODUCT_COPY_FILES，这个变量指定了需要拷贝的文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PRODUCT_COPY_FILES := \  </span><br><span class="line">    $(strip $(PRODUCTS.$(INTERNAL_PRODUCT).PRODUCT_COPY_FILES))</span><br></pre></td></tr></table></figure></p>
<p>接着设置PRODUCT_PROPERTY_OVERRIDES属性：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PRODUCT_PROPERTY_OVERRIDES := \  </span><br><span class="line">    $(strip $(PRODUCTS.$(INTERNAL_PRODUCT).PRODUCT_PROPERTY_OVERRIDES))</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">board_config_mk := \</span><br><span class="line">        $(strip $(sort $(wildcard \</span><br><span class="line">                $(SRC_TARGET_DIR)/board/$(TARGET_DEVICE)/BoardConfig.mk \</span><br><span class="line">                $(shell test -d device &amp;&amp; find -L device -maxdepth 4 -path &apos;*/$(TARGET_DEVICE)/BoardConfig.mk&apos;) \</span><br><span class="line">                $(shell test -d vendor &amp;&amp; find -L vendor -maxdepth 4 -path &apos;*/$(TARGET_DEVICE)/BoardConfig.mk&apos;) \</span><br><span class="line">        )))</span><br><span class="line">ifeq ($(board_config_mk),)</span><br><span class="line">  $(error No config file found for TARGET_DEVICE $(TARGET_DEVICE))</span><br><span class="line">endif</span><br><span class="line">ifneq ($(words $(board_config_mk)),1)</span><br><span class="line">  $(error Multiple board config files for TARGET_DEVICE $(TARGET_DEVICE): $(board_config_mk))</span><br><span class="line">endif</span><br><span class="line">include $(board_config_mk)</span><br></pre></td></tr></table></figure>
<p>至此，板型配置基本加载完毕。开始加载所有模块<br>加载完板型配置信息后，回到main.mk文件中，很快发现了ONE_SHOT_MAKEFILE的使用。如果这个变量被定义了，那么就是编译一个模块，如果没有被定义，就说明是编译整个系统。MAKECMDGOALS是make的一个环境变量，当我们执行make的时候并没有设置它，因此它为空。所以dont_bother不等于true，因此会加载所有的Android.mk，这里是调用一个Python脚本android/build/tools/findleaves.py来查找系统中所有的Android.mk，然后循环include进来：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Include all of the makefiles in the system  </span><br><span class="line"># </span><br><span class="line"># Can&apos;t use first-makefiles-under here because  </span><br><span class="line"># --mindepth=2 makes the prunes not work.  </span><br><span class="line">subdir_makefiles := \  </span><br><span class="line">    $(shell build/tools/findleaves.py $(FIND_LEAVES_EXCLUDES) $(subdirs) Android.mk)  </span><br><span class="line"></span><br><span class="line">ifeq ($(USE_SOONG),true)  </span><br><span class="line">subdir_makefiles := $(SOONG_ANDROID_MK) $(call filter-soong-makefiles,$(subdir_makefiles))  </span><br><span class="line">endif  </span><br><span class="line">$(foreach mk, $(subdir_makefiles),$(info including $(mk) ...)$(eval include $(mk)))</span><br></pre></td></tr></table></figure></p>
<p>那么问题来了,我们要加一个新的<code>产品配置</code>要改什么文件呢?</p>
<h2 id="添加新的产品"><a href="#添加新的产品" class="headerlink" title="添加新的产品"></a>添加新的产品</h2><p>当要开发一款新的 Android 产品的时候，我们首先需要在 Build 系统中添加对于该产品的定义。<br>在 Android Build 系统中对产品定义的文件通常位于 device 目录下。device 目录下根据公司名以及产品名分为二级或多级目录。<br>通常，对于一个产品的定义通常至少会包括四个文件：AndroidProducts.mk，产品版本定义文件，BoardConfig.mk 以及 verndorsetup.sh。</p>
<ul>
<li><p>/device/sprd/scx20/sp7731c_4h10/vendorsetup.sh:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_lunch_combo sp7731c_4h10_native-userdebug</span><br></pre></td></tr></table></figure>
</li>
<li><p>/device/sprd/scx20/sp7731c_4h10/AndroidProducts.mk：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PRODUCT_MAKEFILES := \</span><br><span class="line">    $(LOCAL_DIR)/sp7731c_4h10_native.mk</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>产品版本定义文件：顾名思义，该文件中包含了对于特定产品版本的定义。该文件可能不只一个，因为同一个产品可能会有多种版本（例如，面向中国地区一个版本，面向美国地区一个版本）。<br>文件中可以定义的变量以及含义</p>
<table>
<thead>
<tr>
<th>常量</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>PRODUCT_NAME</td>
<td>最终用户将看到的完整产品名，会出现在“关于手机”信息中。</td>
</tr>
<tr>
<td>PRODUCT_MODEL</td>
<td>产品的型号，这也是最终用户将看到的。</td>
</tr>
<tr>
<td>PRODUCT_LOCALES</td>
<td>该产品支持的地区，以空格分格，例如：en_GB de_DE es_ES fr_CA。</td>
</tr>
<tr>
<td>PRODUCT_PACKAGES</td>
<td>该产品版本中包含的 APK 应用程序，以空格分格，例如：Calendar Contacts。</td>
</tr>
<tr>
<td>PRODUCT_DEVICE</td>
<td>该产品的工业设计的名称。</td>
</tr>
<tr>
<td>PRODUCT_MANUFACTURER</td>
<td>制造商的名称。</td>
</tr>
<tr>
<td>PRODUCT_BRAND</td>
<td>该产品专门定义的商标（如果有的话）。</td>
</tr>
<tr>
<td>PRODUCT_PROPERTY_OVERRIDES</td>
<td>对于商品属性的定义。</td>
</tr>
<tr>
<td>PRODUCT_COPY_FILES</td>
<td>编译该产品时需要拷贝的文件，以“源路径 : 目标路径”的形式。</td>
</tr>
<tr>
<td>PRODUCT_OTA_PUBLIC_KEYS</td>
<td>对于该产品的 OTA 公开 key 的列表。</td>
</tr>
<tr>
<td>PRODUCT_POLICY</td>
<td>产品使用的策略。</td>
</tr>
<tr>
<td>PRODUCT_PACKAGE_OVERLAYS</td>
<td>指出是否要使用默认的资源或添加产品特定定义来覆盖。</td>
</tr>
<tr>
<td>PRODUCT_CONTRIBUTORS_FILE</td>
<td>HTML 文件，其中包含项目的贡献者。</td>
</tr>
<tr>
<td>PRODUCT_TAGS</td>
<td>该产品的标签，以空格分格。</td>
</tr>
</tbody>
</table>
<h2 id="添加新的模块"><a href="#添加新的模块" class="headerlink" title="添加新的模块"></a>添加新的模块</h2><p>在源码树中，一个模块的所有文件通常都位于同一个文件夹中。为了将当前模块添加到整个 Build 系统中，每个模块都需要一个专门的 Make 文件，该文件的名称为“Android.mk”。Build 系统会扫描名称为“Android.mk”的文件，并根据该文件中内容编译出相应的产物。</p>
<p>需要注意的是：在 Android Build 系统中，编译是以模块（而不是文件）作为单位的，每个模块都有一个唯一的名称，一个模块的依赖对象只能是另外一个模块，而不能是其他类型的对象。对于已经编译好的二进制库，如果要用来被当作是依赖对象，那么应当将这些已经编译好的库作为单独的模块。对于这些已经编译好的库使用 <code>BUILD_PREBUILT</code> 或 <code>BUILD_MULTI_PREBUILT</code>。例如：当编译某个 Java 库需要依赖一些 Jar 包时，并不能直接指定 Jar 包的路径作为依赖，而必须首先将这些 Jar 包定义为一个模块，然后在编译 Java 库的时候通过模块的名称来依赖这些 Jar 包。</p>
<h3 id="Android-mk-解析"><a href="#Android-mk-解析" class="headerlink" title="Android.mk 解析"></a>Android.mk 解析</h3><p>在源码树中每一个模块的所有文件通常都相应有一个自己的文件夹，在该模块的根目录下有一个名称为“Android.mk” 的文件。编译系统正是以模块为单位进行编译，每个模块都有唯一的模块名，一个模块可以有依赖多个其他模块，模块间的依赖关系就是通过模块名来引用的。也就是说当模块需要依赖一个jar包或者apk时，必须先将jar包或apk定义为一个模块，然后再依赖相应的模块。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_PATH := $(call my-dir) </span><br><span class="line">include $(CLEAR_VARS)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这两行代码的作用是：<br>设置当前模块的编译路径为当前文件夹路径。<br>清理（可能由其他模块设置过的）编译环境中用到的变量。   </p>
</blockquote>
<p>为了方便模块的编译，Build 系统设置了很多的编译环境变量。要编译一个模块，只要在编译之前根据需要设置这些变量然后执行编译即可。它们包括：</p>
<table>
<thead>
<tr>
<th>变量名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>LOCAL_SRC_FILES</td>
<td>当前模块包含的所有源代码文件。</td>
</tr>
<tr>
<td>LOCAL_MODULE</td>
<td>当前模块的名称，这个名称应当是唯一的，模块间的依赖关系就是通过这个名称来引用的。</td>
</tr>
<tr>
<td>LOCAL_C_INCLUDES</td>
<td>C 或 C++ 语言需要的头文件的路径。LOCAL_STATIC_LIBRARIES：当前模块在静态链接时需要的库的名称。LOCAL_SHARED_LIBRARIES：当前模块在运行时依赖的动态库的名称。</td>
</tr>
<tr>
<td>LOCAL_CFLAGS</td>
<td>提供给 C/C++ 编译器的额外编译参数。</td>
</tr>
<tr>
<td>LOCAL_JAVA_LIBRARIES</td>
<td>当前模块依赖的 Java 共享库。</td>
</tr>
<tr>
<td>LOCAL_STATIC_JAVA_LIBRARIES</td>
<td>前模块依赖的 Java 静态库。LOCAL_PACKAGE_NAME：当前 APK 应用的名称。</td>
</tr>
<tr>
<td>LOCAL_CERTIFICATE</td>
<td>签署当前应用的证书名称。</td>
</tr>
<tr>
<td>LOCAL_MODULE_TAGS</td>
<td>当前模块所包含的标签，一个模块可以包含多个标签。标签的值可能是 debug, eng, user，development 或者 optional(默认)。</td>
</tr>
</tbody>
</table>
<blockquote>
<p>标签是提供给编译类型使用的。不同的编译类型会安装包含不同标签的模块。<br>要编译一个 APK 文件，只需要在 Android.mk 文件中，加入“include $(BUILD_PACKAGE)   </p>
</blockquote>
<p>除此以外，Build 系统中还定义了一些便捷的函数以便在 Android.mk 中使用，包括：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>$(call my-dir)</td>
<td>获取当前文件夹路径。</td>
</tr>
<tr>
<td>$(call all-java-files-under, <src>)</src></td>
<td>获取指定目录下的所有 Java 文件。</td>
</tr>
<tr>
<td>$(call all-c-files-under, <src>)</src></td>
<td>获取指定目录下的所有 C 语言文件。</td>
</tr>
<tr>
<td>$(call all-Iaidl-files-under, <src>)</src></td>
<td>获取指定目录下的所有 AIDL 文件。</td>
</tr>
<tr>
<td>$(call all-makefiles-under, <folder>)</folder></td>
<td>获取指定目录下的所有 Make 文件。</td>
</tr>
<tr>
<td>$(call intermediates-dir-for, <class>, <app_name>, <host or="" target="">, <common?> )</common?></host></app_name></class></td>
<td>获取 Build 输出的目标文件夹路径。</td>
</tr>
</tbody>
</table>
<p>示例:</p>
<ul>
<li><p>编译一个 APK 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_PATH := $(call my-dir) </span><br><span class="line">include $(CLEAR_VARS) </span><br><span class="line"># 获取所有子目录中的 Java 文件</span><br><span class="line">LOCAL_SRC_FILES := $(call all-subdir-java-files)             </span><br><span class="line"># 当前模块依赖的静态 Java 库，如果有多个以空格分隔</span><br><span class="line">LOCAL_STATIC_JAVA_LIBRARIES := static-library </span><br><span class="line"># 当前模块的名称</span><br><span class="line">LOCAL_PACKAGE_NAME := LocalPackage </span><br><span class="line"># 编译 APK 文件</span><br><span class="line">include $(BUILD_PACKAGE)</span><br></pre></td></tr></table></figure>
</li>
<li><p>编译一个 Java 的静态库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_PATH := $(call my-dir) </span><br><span class="line">include $(CLEAR_VARS) </span><br><span class="line"></span><br><span class="line"># 获取所有子目录中的 Java 文件</span><br><span class="line">LOCAL_SRC_FILES := $(call all-subdir-java-files) </span><br><span class="line"></span><br><span class="line"># 当前模块依赖的动态 Java 库名称</span><br><span class="line">LOCAL_JAVA_LIBRARIES := android.test.runner </span><br><span class="line"></span><br><span class="line"># 当前模块的名称</span><br><span class="line">LOCAL_MODULE := sample </span><br><span class="line"></span><br><span class="line"># 将当前模块编译成一个静态的 Java 库</span><br><span class="line">include $(BUILD_STATIC_JAVA_LIBRARY)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="SPROCOMM-Android项目编译脚本"><a href="#SPROCOMM-Android项目编译脚本" class="headerlink" title="SPROCOMM Android项目编译脚本"></a>SPROCOMM Android项目编译脚本</h1><p>介绍完Android原始的编译系统,我们再看看禾苗编译系统做了些什么,我们从<code>buildall_eng.sh</code>说起</p>
<ol>
<li><p>处理并检查脚本参数,最新版本的脚本支持如下参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">usage</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"USAGE: <span class="variable">$0</span> &lt;PROJECT&gt; [ota] [pac] [copy] [boot] [bootloader] [recovery] [snod] [api] [env] [nodex] [-m &lt;MODULE&gt;]"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"* OTA : 编译OTA包"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"* BOOT : 编译boot.img"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"* CHIPRAM : 编译chipram"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"* RECOVERY : 编译recovery.img"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"* BOOTLOADER : 编译bootloader(u-boot.bin)"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"* SNOD : 打包system.img"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"* -m &lt;MODULE&gt; : 编译&lt;MODULE&gt;指定的模块(-m bootloader)"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"* PAC : 编译完成后自动打包(*.pac)"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"* COPY : 拷贝覆盖文件，不启动编译"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"* API : 提示需要更新api时加该参数:更新api.txt，编译完成后请将framework中的api文件提交到git上"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"* ENV : 单编source时加该参数，只设置环境，不启动编译"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"* NODEX : 全编DEBUG版本时不生成odex文件"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"* 参数不区分大小写和顺序"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>为7.0平台设置Java环境变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">javaVersion=`<span class="built_in">echo</span> <span class="variable">$JAVA_HOME</span> | grep <span class="string">"java-8-openjdk-amd64"</span>`</span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$javaVersion</span> ] ; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Set JAVA_HOME as /usr/lib/jvm/java-8-openjdk-amd64"</span></span><br><span class="line">    <span class="built_in">export</span> JAVA_HOME=<span class="string">"/usr/lib/jvm/java-8-openjdk-amd64"</span></span><br><span class="line">    <span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/jre/bin/:<span class="variable">$PATH</span></span><br><span class="line">    <span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin/:<span class="variable">$PATH</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>调用<code>sprplus_target_gen.pl</code>解析项目对应的spec生成配置文件文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./build/buildplus/tool/sprplus_target_gen.pl  <span class="variable">$&#123;PROJECT&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">输出:</span></span><br><span class="line">build/buildplus/buildspec/X50142.spec</span><br><span class="line">Copy build/buildplus/target/Features.java to frameworks/base/core/java/android/plugin/</span><br><span class="line">Copy build/buildplus/target/spr_target.h to kernel/include/linux/</span><br><span class="line">Copy build/buildplus/target/spr_target.h to chipram/include/configs/</span><br><span class="line">Copy build/buildplus/target/spr_target.h to system/core/include/android/</span><br><span class="line">Copy build/buildplus/target/spr_target.h to u-boot64/include/configs/</span><br><span class="line">Copy build/buildplus/target/spr_target.h to kernel/scripts/</span><br></pre></td></tr></table></figure>
<ol>
<li><p>拷贝覆盖文件和编译ota时所需要的modem以及audio_para文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Copy overlay files ##</span></span><br><span class="line">OVERLAY_FILE=./sprocomm_proj/<span class="variable">$&#123;PROJECT&#125;</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="variable">$&#123;OVERLAY_FILE&#125;</span> ] ; <span class="keyword">then</span></span><br><span class="line">    cp -rf <span class="variable">$&#123;OVERLAY_FILE&#125;</span>/* ./</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"WARNING!!! Overlay file Not found!"</span> ; sleep 2</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">modem_bins_dir=device/sprd/<span class="variable">$&#123;CONFIG_DEVICE_PLATFORM&#125;</span>/<span class="variable">$&#123;CONFIG_DEVICE_BOARD&#125;</span>/modem_bins</span><br><span class="line">audio_paras_dir=device/sprd/<span class="variable">$&#123;CONFIG_DEVICE_PLATFORM&#125;</span>/<span class="variable">$&#123;CONFIG_DEVICE_BOARD&#125;</span>/rootdir/system/etc/audio_params/audio_para</span><br><span class="line"></span><br><span class="line">modem_dir=modem/<span class="variable">$&#123;PROJECT&#125;</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"default"</span> != <span class="variable">$&#123;BUILD_HARDWARE_CLASS&#125;</span> ];<span class="keyword">then</span></span><br><span class="line">    modem_dir=modem/<span class="variable">$&#123;PROJECT&#125;</span>-<span class="variable">$&#123;BUILD_HARDWARE_CLASS&#125;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -e <span class="variable">$&#123;modem_dir&#125;</span>/audio_para ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"copy "</span><span class="variable">$&#123;modem_dir&#125;</span>/audio_para<span class="string">" to "</span><span class="variable">$&#123;audio_paras_dir&#125;</span></span><br><span class="line">    cp <span class="variable">$&#123;modem_dir&#125;</span>/audio_para <span class="variable">$&#123;audio_paras_dir&#125;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">mkdir -p <span class="variable">$&#123;modem_bins_dir&#125;</span></span><br><span class="line">cp <span class="variable">$&#123;modem_dir&#125;</span>/DSP_DM_G2.bin  <span class="variable">$&#123;modem_bins_dir&#125;</span>/wdsp.bin</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"true"</span> = <span class="variable">$&#123;BUILD_COPY_ONLY&#125;</span> ] ; <span class="keyword">then</span></span><br><span class="line">    [ <span class="variable">$BUILD_ENV</span> = <span class="string">"false"</span> ] &amp;&amp; <span class="built_in">exit</span> 1; <span class="built_in">return</span>;</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>执行Android原生的编译脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> build/envsetup.sh</span><br><span class="line">lunch <span class="variable">$&#123;CONFIG_DEVICE_PRODUCT&#125;</span>-userdebug</span><br><span class="line">choosevariant <span class="variable">$&#123;varient_val&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>执行展讯编译kernel额外的命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kheader</span><br><span class="line">kdconfig</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果有必要则重启一次jack服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vmArg=`<span class="built_in">echo</span> <span class="variable">$JACK_SERVER_VM_ARGUMENTS</span> | grep <span class="string">"Xmx4096m"</span>`</span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$vmArg</span> ] ; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">export</span> JACK_SERVER_VM_ARGUMENTS=<span class="string">"-Dfile.encoding=UTF-8 -XX:+TieredCompilation -Xmx4096m"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"restart jack server"</span></span><br><span class="line">    bash ./prebuilts/sdk/tools/jack-admin <span class="built_in">kill</span>-server </span><br><span class="line">    bash ./prebuilts/sdk/tools/jack-admin start-server</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>拷贝展讯7.0平台提供的proprietories文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Copy SPRD7.0 proprietories files</span></span><br><span class="line">PROPRIETORIES=<span class="string">"vendor/sprd/proprietories-out/<span class="variable">$&#123;CONFIG_DEVICE_PRODUCT&#125;</span>-<span class="variable">$&#123;BUILD_VARIANT&#125;</span>"</span></span><br><span class="line"><span class="keyword">if</span> [ ! -e <span class="variable">$PROPRIETORIES</span> ]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PROPRIETORIES</span> not exists, using native file...</span><br><span class="line">sleep 3</span><br><span class="line">PROPRIETORIES=<span class="string">"vendor/sprd/proprietories-out/<span class="variable">$&#123;CONFIG_DEVICE_BOARD&#125;</span>_native-<span class="variable">$&#123;BUILD_VARIANT&#125;</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> Copy <span class="variable">$PROPRIETORIES</span> to out</span><br><span class="line">cp -rf <span class="variable">$PROPRIETORIES</span>/* .</span><br></pre></td></tr></table></figure>
</li>
<li><p>开始编译</p>
<blockquote>
<p><code>BUILD_MODULE_CMD</code> 可能会指定一些别的模块,这样就会编译指定的模块,而不是整个android系统</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MULTILANGUAGE_SUPPORT=<span class="literal">true</span> DEBUG_WITH_DEXPREOPT=<span class="variable">$&#123;DEBUG_WITH_DEXPREOPT&#125;</span> make <span class="variable">$&#123;BUILD_MODULE_CMD&#125;</span> -j<span class="variable">$JN</span> 2&gt;&amp;1 | tee <span class="variable">$&#123;SAVE_PATH&#125;</span>/build.log</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>如果有必要,则编译并打包ota包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#build otapackage#</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"true"</span> = <span class="variable">$&#123;BUILD_OTA&#125;</span> ] ; <span class="keyword">then</span></span><br><span class="line">    MULTILANGUAGE_SUPPORT=<span class="literal">true</span> DEBUG_WITH_DEXPREOPT=<span class="variable">$&#123;DEBUG_WITH_DEXPREOPT&#125;</span> make otapackage -j<span class="variable">$JN</span> 2&gt;&amp;1 | tee <span class="variable">$&#123;SAVE_PATH&#125;</span>/buildOta.log</span><br><span class="line">    RESULT=<span class="variable">$&#123;PIPESTATUS[0]&#125;</span> ; <span class="keyword">if</span> [ ! <span class="string">"0"</span> = <span class="variable">$&#123;RESULT&#125;</span> ] ; <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">"Build Abort!"</span>; [ <span class="variable">$BUILD_ENV</span> = <span class="string">"false"</span> ] &amp;&amp; <span class="built_in">exit</span> 1; <span class="built_in">return</span>; <span class="keyword">fi</span></span><br><span class="line">    <span class="comment">#cp -f $&#123;BUILD_OUT_DIR&#125;/*-ota-*.zip $&#123;SAVE_PATH&#125;</span></span><br><span class="line">    cp -f <span class="variable">$&#123;BUILD_OUT_DIR&#125;</span>/*-fota-Package.zip <span class="variable">$&#123;SAVE_PATH&#125;</span></span><br><span class="line">    </span><br><span class="line">    RESULT=$? ; <span class="keyword">if</span> [ ! <span class="string">"0"</span> = <span class="variable">$&#123;RESULT&#125;</span> ] ; <span class="keyword">then</span> </span><br><span class="line">        cp -f <span class="variable">$&#123;BUILD_OUT_DIR&#125;</span>/obj/PACKAGING/target_files_intermediates/*target_files*.zip <span class="variable">$&#123;SAVE_PATH&#125;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果有必要则打包生成的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Start Pack ##</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"true"</span> = <span class="variable">$&#123;BUILD_PAC&#125;</span> ] ; <span class="keyword">then</span></span><br><span class="line">    cp -f <span class="variable">$&#123;BUILD_OUT_DIR&#125;</span>/system/build.prop <span class="variable">$&#123;SAVE_PATH&#125;</span></span><br><span class="line">    cp -f <span class="variable">$&#123;BUILD_OUT_DIR&#125;</span>/obj/KERNEL/vmlinux <span class="variable">$&#123;SAVE_PATH&#125;</span></span><br><span class="line">    <span class="keyword">if</span> [ ! <span class="string">"user"</span> = <span class="variable">$&#123;BUILD_VARIANT&#125;</span> ]; <span class="keyword">then</span></span><br><span class="line">        zip -r <span class="variable">$&#123;SAVE_PATH&#125;</span>_ENG.zip <span class="variable">$&#123;SAVE_PATH&#125;</span>/*</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        zip -r <span class="variable">$&#123;SAVE_PATH&#125;</span>.zip <span class="variable">$&#123;SAVE_PATH&#125;</span>/*</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    rm <span class="variable">$&#123;SAVE_PATH&#125;</span> -rf;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"default"</span> != <span class="variable">$&#123;BUILD_HARDWARE_CLASS&#125;</span> ];<span class="keyword">then</span></span><br><span class="line">        ./make_pac.sh <span class="variable">$&#123;PROJECT&#125;</span> <span class="variable">$&#123;BUILD_HARDWARE_CLASS&#125;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        ./make_pac.sh <span class="variable">$&#123;PROJECT&#125;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>至此是编译的全部流程,其中有几点需要我们注意:   </p>
<h2 id="SPEC文件的规则"><a href="#SPEC文件的规则" class="headerlink" title="SPEC文件的规则"></a>SPEC文件的规则</h2><p>Android 7.0平台上我重写了SPEC文件的规则和解析脚本,规则如下</p>
<ol>
<li>每个项目都应该有一个与项目名相同的spec文件,如<code>build/buildplus/buildspec/X50142.spec</code></li>
<li>spec 文件使用分号(“;”)标识注释, 并要求行尾不要有windows换行符”\r”(7.0引入jack,该符号会导致编译报错)</li>
<li>将所有的变量整理在一起，去掉不需要的变量，并规范变量名   </li>
<li>变量规则，所有定义的变量都按照KEY\<type\>=VALUE的格式书写，其中TYPE支持如下几种：   <blockquote>
<pre><code>* BUILD : Makefile 变量   
* String：Java变量   
* int : Java 变量   
* boolean： Java变量   
* Native ： C/C++  常量   
* DEFINE:  C/C++ 宏 （value=1 时生成#define KEY， 否则生成#define KEY_UNDEFINED）   
</code></pre></blockquote>
</type\></li>
<li>添加一个新的变量时需要先在<code>build\buildplus\namespace\names.ini</code>配置其默认值(如果xxx.spec中未定义,则生成的文件中变量的值未name.ini中定义的默认值),否则添加的变量不能反应到输出的文件中</li>
<li>去除6.0中的如下属性ro.project.customer_name、ro.project.customer_sku、ro.project.name（原因: 衍生项目有可能被用户看到别的客户名，有些代码将getprop放在循环中引发性能问题）所有Java中判断属性通过如下常量获取<blockquote>
<pre><code>* android.os.Build.CUSTOMER ： 客户名   
* android.os.Build.CUSTOMER_SKU ： 客户品牌名（Lava/Xolo）   
* android.os.Build.PROJECT ： 项目名   
</code></pre></blockquote>
</li>
<li>针对之前项目与device目录对应关系不清楚问题，将以前的CONFIG_DEVICE_BOARD  = scx20、CONFIG_DEVICE_PRODUCT  = sp7731c_1h10修改为3个宏，创建项目时请注意：<blockquote>
<pre><code>* CONFIG_DEVICE_PLATFORM\&lt;BUILD\&gt;  = scx20   
* CONFIG_DEVICE_BOARD\&lt;BUILD\&gt;  = sp7731c_1h10   
* CONFIG_DEVICE_PRODUCT\&lt;BUILD\&gt;  = sp7731c_1h10_oversea   
</code></pre></blockquote>
</li>
<li>BUILD类型的变量的值不允许添加引号</li>
</ol>
<h2 id="SPEC文件的解析"><a href="#SPEC文件的解析" class="headerlink" title="SPEC文件的解析"></a>SPEC文件的解析</h2><ol>
<li>SPEC文件使用<code>sprplus_target_gen.pl</code>脚本解析,并在<code>build\buildplus\target</code>目录下生成3个文件<blockquote>
<ul>
<li>Features.java</li>
<li>spr_target.h</li>
<li>spr_target.min<br>分别供java, c/c++, 以及makefile使用<br>其中<code>spr_target.h</code>还会被copy到”kernel”, “chipram”, “uboot”, “system”代码的include文件夹中<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my $targetDefaultNativePath = <span class="string">"build/buildplus/target/spr_target.h"</span>;</span><br><span class="line">my @targetNativePaths =  (<span class="string">"kernel/include/linux/"</span>,</span><br><span class="line">                    <span class="string">"chipram/include/configs/"</span>,</span><br><span class="line">                    <span class="string">"system/core/include/android/"</span>,</span><br><span class="line">                    <span class="string">"u-boot64/include/configs/"</span>,</span><br><span class="line">                    <span class="string">"kernel/scripts/"</span>,);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
</li>
</ol>
<h2 id="关于覆盖目录"><a href="#关于覆盖目录" class="headerlink" title="关于覆盖目录"></a>关于覆盖目录</h2><p>由于驱动中的部分文件不方便作项目区分,保留了覆盖目录,覆盖目录位于./sprocomm_proj/${PROJECT},在编译或者source单编的时候会被拷贝覆盖到原始的代码中.<br>因为滥用覆盖目录会经常会导致代码被误提交,修改不生效,升级大版本复杂等问题, 请尽量避免使用覆盖的方式区分项目和代码, 同时脚本中也做了限制,禁止如下几种类型添加到覆盖目录中,当在覆盖目录中创建这几类文件时会提示错误</p>
<blockquote>
<ul>
<li>.java</li>
<li>.cpp</li>
<li>.cc</li>
<li>.mk</li>
<li>.sh</li>
<li>.py</li>
<li>.pl<br>如果无论如何都要覆盖这几个文件,此时可以删除.git/hooks/pre-commit再重新commit(pre-commit文件会在重新编译后再次生成)</li>
</ul>
</blockquote>
<ul>
<li>关于各类文件区分项目,可以参考如下修改<br><a href="http://192.168.11.104/gitweb/?p=MOCORDROID7.0_Trunk_K310_17A_W17.04.2.git;a=commitdiff;h=77a7000d049c44a3e5cc35fa985f7949f8b4c9ed;hp=fefbe6f615f18e2153ac7f9d35db9ca4f97778fc" target="_blank" rel="noopener">参考代码</a></li>
</ul>
<ol>
<li>java文件,先在spec中定义变量(JAVA_VALUE_WIFI_HOT_SSID):<blockquote>
<p>JAVA_VALUE_WIFI_HOT_SSID\<string\> = “alcatel U5”;</string\></p>
</blockquote>
</li>
</ol>
<p>再修改代码引用:<br><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">      */</span><br><span class="line">     private WifiConfiguration getDefaultApConfiguration() &#123;</span><br><span class="line">         WifiConfiguration config = new WifiConfiguration();</span><br><span class="line"><span class="deletion">-        config.SSID = mContext.getResources().getString(</span></span><br><span class="line"><span class="deletion">-                R.string.wifi_tether_configure_ssid_default);</span></span><br><span class="line"><span class="addition">+        //SPROCOMM</span></span><br><span class="line"><span class="addition">+        //config.SSID = mContext.getResources().getString(</span></span><br><span class="line"><span class="addition">+        //        R.string.wifi_tether_configure_ssid_default);</span></span><br><span class="line"><span class="addition">+        config.SSID = android.plugin.Features.JAVA_VALUE_WIFI_HOT_SSID;</span></span><br><span class="line">         config.allowedKeyManagement.set(KeyMgmt.WPA2_PSK);</span><br></pre></td></tr></table></figure></p>
<ol>
<li>makfile文件,同样定义变量:<blockquote>
<p>MODULES_PROJECT_NAME\<build\> = X50142   </build\></p>
</blockquote>
</li>
</ol>
<p>再修改引用代码:<br><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--- a/idh.code/device/sprd/scx20/sp7731c_1h10/BoardConfig.mk</span></span><br><span class="line"><span class="comment">+++ b/idh.code/device/sprd/scx20/sp7731c_1h10/BoardConfig.mk</span></span><br><span class="line">@@ -146,3 +146,14 @@ DEVICE_GSP_NOT_SCALING_UP_TWICE := true</span><br><span class="line"> </span><br><span class="line"> #UCAM feature</span><br><span class="line"> TARGET_BOARD_CAMERA_FACE_BEAUTY := true # hal config</span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+include build/buildplus/target/spr_target.min</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+ifeq ($(MODULES_PROJECT_NAME), X50142)</span></span><br><span class="line"><span class="addition">+CAMERA_SENSOR_TYPE_BACK := "ov5005_mipi_raw"</span></span><br><span class="line"><span class="addition">+CAMERA_SENSOR_TYPE_FRONT := "gc030a_mipi_raw"</span></span><br><span class="line"><span class="addition">+BOARD_HAVE_ACC := BMA2X2</span></span><br><span class="line"><span class="addition">+BOARD_ACC_INSTALL := 0</span></span><br><span class="line"><span class="addition">+BOARD_HAVE_PLS := TP</span></span><br><span class="line"><span class="addition">+BOARD_PLS_COMPATIBLE := false</span></span><br><span class="line"><span class="addition">+endif</span></span><br></pre></td></tr></table></figure></p>
<ol>
<li>c/c++代码,同样定义变量   <blockquote>
<p>NATIVE_DISPLAY_NAME_CAMERA_VENDOR\<native\> = “alcatel”   </native\></p>
</blockquote>
</li>
</ol>
<p>再修改代码引用<br><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--- a/idh.code/vendor/sprd/modules/libcamera/oem2v0/src/cmr_setting.c</span></span><br><span class="line"><span class="comment">+++ b/idh.code/vendor/sprd/modules/libcamera/oem2v0/src/cmr_setting.c</span></span><br><span class="line"><span class="meta">@@ -26,7 +26,7 @@</span></span><br><span class="line"> #include "sensor_drv_u.h"</span><br><span class="line"> #include "cmr_exif.h"</span><br><span class="line"> #include "cmr_oem.h"</span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="addition">+#include \&lt;android/spr_target.h\&gt;</span></span><br><span class="line"> </span><br><span class="line"> #define SETTING_MSG_QUEUE_SIZE              5</span><br><span class="line"> </span><br><span class="line">@@ -1506,11 +1506,15 @@ static cmr_int setting_get_exif_info(struct setting_component *cpt,</span><br><span class="line">     strcpy((char *)p_exif_info-\&gt;primary.img_desc_ptr-\&gt;ImageDescription, (char *)image_desc);</span><br><span class="line">     memset(property,'\0',sizeof(property));</span><br><span class="line">     property_get("ro.product.manufacturer", property, EXIF_DEF_MAKER);</span><br><span class="line"><span class="deletion">-    strcpy((char *)p_exif_info-\&gt;primary.img_desc_ptr-\&gt;Make, (char *)property);</span></span><br><span class="line"><span class="addition">+    //SPROCOMM</span></span><br><span class="line"><span class="addition">+    //strcpy((char *)p_exif_info-\&gt;primary.img_desc_ptr-\&gt;Make, (char *)property);</span></span><br><span class="line"><span class="addition">+    strcpy((char *)p_exif_info-\&gt;primary.img_desc_ptr-\&gt;Make, NATIVE_DISPLAY_NAME_CAMERA_VENDOR);</span></span><br><span class="line">     </span><br><span class="line">     memset(property,'\0',sizeof(property));</span><br><span class="line">     property_get("ro.product.model", property, EXIF_DEF_MODEL);</span><br></pre></td></tr></table></figure></p>
<p>或者定义:</p>
<blockquote>
<p>SUPPORT_OTG\<define\> = 0;<br>那spr_target.h代码中将生成:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SUPPORT_OTG_UNDEFINED</span></span><br></pre></td></tr></table></figure></define\></p>
<p>SUPPORT_OTG\<define\> = 1;(或者”true”/“yes”)<br>那spr_target.h代码中将生成:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SUPPORT_OTG</span></span><br></pre></td></tr></table></figure></define\></p>
</blockquote>
<h2 id="Android应用资源文件的覆盖规则"><a href="#Android应用资源文件的覆盖规则" class="headerlink" title="Android应用资源文件的覆盖规则"></a>Android应用资源文件的覆盖规则</h2><p>我们在Android上层开发时经常会遇到替换图标/壁纸/布局/字符,串等资源,Android编译系统提供了两个变量(DEVICE_PACKAGE_OVERLAYS/PRODUCT_PACKAGE_OVERLAYS)可以控制资源文件的覆盖问题(AndroidManifest.xml不支持这种覆盖方式),我们创建了一个目录<code>vendor/sprocomm_overlays/$(MODULES_PROJECT_NAME)</code>放置这些要覆盖的文件,在全编或者单编时会自动引用该文件夹下的文件而无需拷贝(图片和布局这类一个文件生成一个R.java中id的文件需要保持文件名不变,字符串这类一个变量生成一个id的则可以为文件随便命名)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HAVE_SPR_OVERLAY_FILE := $(shell test -d vendor/sprocomm_overlays/$(MODULES_PROJECT_NAME) &amp;&amp; echo yes)  </span><br><span class="line">ifeq ($(strip $(HAVE_SPR_OVERLAY_FILE)),yes)</span><br><span class="line">    $(warning &apos;Including sprocomm overlays&apos;) </span><br><span class="line">    PRODUCT_PACKAGE_OVERLAYS += \</span><br><span class="line">        vendor/sprocomm_overlays/$(MODULES_PROJECT_NAME)</span><br><span class="line">else</span><br><span class="line">    $(warning &apos;No sprocomm overlays&apos;) </span><br><span class="line">endif</span><br></pre></td></tr></table></figure></p>
<p>如我想替换X50142的Setting的图标,那么将新的图标文件放在:<code>vendor/sprocomm_overlays/X50142/packages/apps/Settings/res/mipmap-hdpi/ic_launcher_settings.png</code></p>
<p>如我想修改Chrome浏览器的主页和书签,那么我可以创建一个xml(<strong>文件名任意</strong>)放置在<code>vendor/sprocomm_overlays/X50142/packages/providers/PartnerBookmarksProvider/res/values/overlay_bookmarks.xml</code>,文件内容如下:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注意此处,我们并没有覆盖bookmarks_folder_name,那么bookmarks_folder_name将使用原来的值 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--string name="bookmarks_folder_name" translatable="false"&gt;Partner Bookmarks&lt;/string--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 我们并不关注homepage这个字符串原来是定义到哪个xml文件中的,我们只要写在这里就能生效 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"homepage"</span> <span class="attr">translatable</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">        http://www.alcatel-mobile.com<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- Bookmarks icon--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">array</span> <span class="attr">name</span>=<span class="string">"bookmark_preloads"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span><span class="tag">&lt;/<span class="name">item</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span><span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span><span class="tag">&lt;/<span class="name">item</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span><span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Bookmarks --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string-array</span> <span class="attr">name</span>=<span class="string">"bookmarks"</span> <span class="attr">translatable</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>My Onetouch<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>http://3g.my-onetouch.com<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>Alcatel Store<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>http://shop.alcatel-mobile.com<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">string-array</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>同样的我们还可以用这种方法修改系统framework/base/core/res/values/configs.xml或者SettingProvider中的配置而无需覆盖整个文件</p>
<p>另外如果我们需要为X50142项目在Settings<code>/res/raw</code>文件夹中添加一个新文件xx.ogg,我们只需要将xx.ogg放在<code>vendor/sprocomm_overlays/X50142/packages/apps/Settings/res/raw</code>文件夹下,这样编译别的项目时就不会把这个文件编译进去,减小APK体积</p>
<p>个人墙裂建议把spec中定义的SettingProvider中的各个默认值移除用这种方式来覆盖(1. 尊重Android原始设计,避免代码混乱 2. 减少因为spec中添加变量导致的需要重新全编问题)</p>
<h1 id="SPROCOMM-Android项目编译命令"><a href="#SPROCOMM-Android项目编译命令" class="headerlink" title="SPROCOMM Android项目编译命令"></a>SPROCOMM Android项目编译命令</h1><h2 id="全编译"><a href="#全编译" class="headerlink" title="全编译"></a>全编译</h2><p>当安装好环境并下载代码后，通常需要将整套代码完整编译一次, 编译脚本一般有两个<code>buildall_user.sh</code>,<code>buildall_eng.sh</code>，前者用于编译发布给客户的版本，后者用于编译研发自己使用的版本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./buildall_eng.sh X4568LV snod pac</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>其中:</p>
<ul>
<li>X4568LV : 项目名</li>
<li><code>pac</code>   : 打包参数，用于将编译生成的img文件打包成下载工具可以识别的文件格式</li>
<li>其他参数(如<code>./buildall_eng.sh X4568LV snod</code>直接打包生成system.img)请直接运行<code>buildall_eng.sh</code>查看帮助提示</li>
</ul>
</blockquote>
<h2 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./make_pac.sh X4568LV</span><br></pre></td></tr></table></figure>
<blockquote>
<p>用于将编译生成的文件手动打包为下载工具可以识别的文件格式</p>
<p>完整编译时会在代码根目录下生成一个文件夹或压缩包，其中包含当前代码的git版本号，和编译过程中产生的log，以及用于后期调试需要的vmlinux备份文件。 当编译失败时，需要检查其中的<code>build.log</code>或<code>buildOta.log</code> 根据log排除编译错误</p>
</blockquote>
<h2 id="单编模块"><a href="#单编模块" class="headerlink" title="单编模块"></a>单编模块</h2><p>修改了一个模块的代码后需要编译验证，在一个新的终端中第一次单编时需要先导入环境变量(单编user版本的模块需要用buildall_user.sh)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> buildall_eng.sh X4568LV env</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>实际是将<code>source build/envsetup.sh</code>等命令批量运行了一遍<br>导入环境变量时注意全编的是哪个项目(以及什么版本),如果与全编时不一致很可能会自动删除掉out目录下的一些文件,导致需要重新全编译(新版本的脚本检测到不一致时会提示)</p>
</blockquote>
<p>导入环境变量后就可以单独编译模块了</p>
<ul>
<li><code>mm</code>  单编当前目录的模块</li>
<li><code>mmm &lt;module_path&gt;</code> 单编<code>&lt;module_path&gt;</code>路径所指向的模块</li>
<li>单编完成后会在<code>out/target/product/xxxxx/system/</code>目录对于的文件夹下生成编译好的模块，可以安装或push到手机中验证</li>
<li>推送文件到手机需要使用<code>adb</code>命令，请参考ADB章节</li>
</ul>
<h1 id="编译错误处理"><a href="#编译错误处理" class="headerlink" title="编译错误处理"></a>编译错误处理</h1><ol>
<li>GC overhead limit exceeded </li>
<li>OOM</li>
</ol>
<blockquote>
<p>Try increasing heap size with Java option ‘-Xmx’<br>解决方法：<a href="http://blog.csdn.net/brightming/article/details/49763515" target="_blank" rel="noopener">http://blog.csdn.net/brightming/article/details/49763515</a><br>修改 prebuilts/sdk/tools/jack-admin<br>在下面这行中，增加 -Xmx4096m<br>JACK_SERVER_COMMAND=”java -Djava.io.tmpdir=$TMPDIR$JACK_SERVER_VM_ARGUMENTS -Xmx4096m -cp $LAUNCHER_JAR</p>
</blockquote>
<ol>
<li><p>提示adb.iso 文件找不到导致编译失败, 需要系统中安装 mkisofs , genisoimage</p>
<blockquote>
<p>sudo apt-get install genisoimage</p>
</blockquote>
</li>
<li><p>提示”WARNING!!! can’t find board directory [device/sprd/scx20_/sp7731c<em>1h10</em>]”, 特点是<code>scx20_</code>和<code>sp7731c_1h10_</code>后面有个下划线</p>
<blockquote>
<p>原因是Windows系统中的换行符比linux多一个<code>&quot;\r&quot;</code>,需要用文本编辑器删除</p>
</blockquote>
</li>
<li><p>语法正确的Makefile（xxx.mk） 在编译时提示”xxxxxxx <em>*</em> missing separator. “</p>
<blockquote>
<p>原因也是Windows换行符,需要删除<code>&quot;\r&quot;</code></p>
</blockquote>
</li>
<li><p>6.0和7.0都可能遇到的Can’t Launch Jack.</p>
<blockquote>
<p>Jack服务可能时由于内存等原因没有启动,重新编译一次即可</p>
</blockquote>
</li>
</ol>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="http://www.jianshu.com/p/sTeAbC" target="_blank" rel="noopener">http://www.jianshu.com/p/sTeAbC</a></li>
<li><a href="http://blog.csdn.net/lizekun2010/article/details/52598105" target="_blank" rel="noopener">http://blog.csdn.net/lizekun2010/article/details/52598105</a></li>
<li>BOOK: Embedded Android</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/13/Git常用指令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JamesWong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JamesWong's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/13/Git常用指令/" itemprop="url">Git常用指令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-13T22:07:18+08:00">
                2017-03-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Git常用指令"><a href="#Git常用指令" class="headerlink" title="Git常用指令"></a>Git常用指令</h3><ul>
<li><img src="http://i.imgur.com/vM452Xj.png" alt=""><ul>
<li>Workspace：工作区</li>
<li>Index / Stage：暂存区</li>
<li>Repository：仓库区</li>
<li>Remote：远程仓库</li>
</ul>
</li>
</ul>
<hr>
<ol>
<li><p>新建代码库</p>
<ul>
<li>在当前目录新建一个Git代码库<ul>
<li><strong>git init</strong></li>
</ul>
</li>
<li>新建一个目录，将其初始化为Git代码库<ul>
<li><strong>git init [project-name]</strong></li>
</ul>
</li>
<li>复制一个项目和它的整个代码历史<ul>
<li><strong>git clone [url]</strong></li>
</ul>
</li>
</ul>
</li>
<li><p>配置</p>
<ul>
<li>分为全局配置和项目配置 <strong>.git</strong>文件</li>
<li>显示当前的Git配置<ul>
<li><strong>git config –list</strong></li>
</ul>
</li>
<li>编辑Git配置文件<ul>
<li><strong>git config -e [–global]</strong></li>
</ul>
</li>
<li><strong>git config [–global] user.name ‘[name]’</strong></li>
<li><strong>git config [–global] user.email ‘[email]’</strong></li>
</ul>
</li>
<li><p>增加、删除文件</p>
<ul>
<li>添加指定文件到暂存区<ul>
<li><strong>git add [file1] [file2] …</strong></li>
</ul>
</li>
<li>添加指定目录到暂存区，包括子目录<ul>
<li><strong>git add [dir]</strong></li>
</ul>
</li>
<li>添加当前目录的所有文件到暂存区<ul>
<li><strong>git add .</strong></li>
</ul>
</li>
<li>添加每个变化前，都会要求确认，对于同一个文件的多出变化可以实现分次提交<ul>
<li><strong>git add -p</strong></li>
</ul>
</li>
<li>删除工作区文件，并且将这次删除放入暂存区<ul>
<li><strong>git rm [file1] [file2] …</strong></li>
</ul>
</li>
<li>停止追踪指定文件，但该文件会保留在工作区<ul>
<li><strong>git rm –cached [file]</strong></li>
</ul>
</li>
<li>改名文件，并且将这个改名放入暂存区<ul>
<li><strong>git mv [file-original] [file-renamed]</strong></li>
</ul>
</li>
</ul>
</li>
<li><p>代码提交</p>
<ul>
<li>提交暂存区到仓库区<ul>
<li><strong>git commit -m [message]</strong></li>
</ul>
</li>
<li>提交暂存区的指定文件到仓库区<ul>
<li><strong>git commit [file1] [file2] … -m [message]</strong></li>
</ul>
</li>
<li>提交工作区自上次commit之后的变化，直接到仓库区<ul>
<li><strong>git commit -a</strong></li>
</ul>
</li>
<li>提交时显示所有diff信息<ul>
<li><strong>git commit -v</strong></li>
</ul>
</li>
<li>使用一次新的commit，代替上一次提交，如果代码没有任何新变化，则用来改写上一次commit的提交信息<ul>
<li><strong>git commit –amend -m [message]</strong>：</li>
</ul>
</li>
<li>重做上一次commit，并包括指定文件的新变化<ul>
<li><strong>git commit –amend [file1] [file2] …</strong></li>
</ul>
</li>
</ul>
</li>
<li><p>分支</p>
<ul>
<li>列出所有本地分支<ul>
<li><strong>git branch</strong></li>
</ul>
</li>
<li>列出所有远程分支<ul>
<li><strong>git branch -r</strong></li>
</ul>
</li>
<li>列出所有本地和远程分支<ul>
<li><strong>git branch -a</strong></li>
</ul>
</li>
<li>新建一个分支，但依然停留在当前分支<ul>
<li><strong>git branch [branch-name]</strong></li>
</ul>
</li>
<li>新建一个分支，并且切换到该分支<ul>
<li><strong>git checkout -b [branch]</strong></li>
</ul>
</li>
<li>新建一个分支，指向指定commit<ul>
<li><strong>git branch [branch] [commit]</strong></li>
</ul>
</li>
<li>新建一个分支，与指定的远程分支建立追踪关系<ul>
<li><strong>git branch –track [branch] [remote-branch]</strong>：</li>
</ul>
</li>
<li>切换到指定分支，并更新工作区<ul>
<li><strong>git checkout [branch-name]</strong></li>
</ul>
</li>
<li>切换到上一分支<ul>
<li><strong>git checkout -</strong></li>
</ul>
</li>
<li>建立追踪关系，与现有分支与指定的远程分支之间<ul>
<li><strong>git branch –set -upstream [branch] [remote-branch]</strong></li>
</ul>
</li>
<li>合并指定分支到当前分支<ul>
<li><strong>git merge [branch]</strong></li>
</ul>
</li>
<li>选择一个commit，合并进当前分支<ul>
<li><strong>git cherry-pick [commit]</strong></li>
</ul>
</li>
<li>删除分支<ul>
<li><strong>git branch -d [branch-name]</strong></li>
</ul>
</li>
<li>删除远程分支<ul>
<li><strong>git push origin –delete [branch-name]</strong></li>
<li><strong>git branch -dr [remote/branch]</strong></li>
</ul>
</li>
</ul>
</li>
<li><p>标签</p>
<ul>
<li>列出所有tag    <ul>
<li><strong>git tag</strong></li>
</ul>
</li>
<li>新建一个tag在当前commit<ul>
<li><strong>git tag [tag]</strong></li>
</ul>
</li>
<li>新建一个tag在指定commit<ul>
<li><strong>git tag [tag] [commit]</strong></li>
</ul>
</li>
<li>删除本地tag<ul>
<li><strong>git tag -d [tag]</strong></li>
</ul>
</li>
<li>删除远程tag<ul>
<li><strong>git push origin :refs/tags/[tagName]</strong></li>
</ul>
</li>
<li>查看tag信息<ul>
<li><strong>git show [tag]</strong></li>
</ul>
</li>
<li>提交指定tag<ul>
<li><strong>git push [remote] [tag]</strong></li>
</ul>
</li>
<li>提交所有tag<ul>
<li><strong>git push [remote] –tags</strong></li>
</ul>
</li>
<li>新建一个分支，指向某个tag<ul>
<li><strong>git checkout -b [branch] [tag]</strong></li>
</ul>
</li>
</ul>
</li>
<li><p>查看信息</p>
<ul>
<li>显示有变更的文件<ul>
<li><strong>git status</strong></li>
</ul>
</li>
<li>显示当前分支的版本历史<ul>
<li><strong>git log</strong></li>
</ul>
</li>
<li>显示commit历史，以及每次commit发生变更的文件<ul>
<li><strong>git log –stat</strong></li>
</ul>
</li>
<li>搜索提交历史，根据关键词<ul>
<li><strong>git log -S [keyword]</strong></li>
</ul>
</li>
<li>显示某个commit之后的所有变动，每个commit占据一行<ul>
<li><strong>git log [tag] HEAD –pretty=format:%s</strong></li>
</ul>
</li>
<li>显示某个commite之后的所有变动，其“提交说明”必须符合搜索条件<ul>
<li><strong>git log [tag] HEAD –grep feature</strong></li>
</ul>
</li>
<li>显示某个文件的版本历史，包括文件改名<ul>
<li><strong>git log –follow [file]</strong></li>
<li><strong>git whatchanged [file]</strong></li>
</ul>
</li>
<li>显示指定文件相关的每一次diff<ul>
<li><strong>git log -p [file]</strong></li>
</ul>
</li>
<li>显示过去5次提交<ul>
<li><strong>git log -5 –pretty –oneline</strong></li>
</ul>
</li>
<li>显示所有提交过的用户，按提交次数排序<ul>
<li><strong>git shortlog -sn</strong></li>
</ul>
</li>
<li>显示指定文件是什么人在什么时间修改过<ul>
<li><strong>git blame [file]</strong></li>
</ul>
</li>
<li>显示暂存区和工作区的差异<ul>
<li><strong>git diff</strong></li>
</ul>
</li>
<li>显示暂存区和上一个commit的差异<ul>
<li><strong>git diff –cached [file]</strong></li>
</ul>
</li>
<li>显示工作区与当前分支最新commit之间的差异<ul>
<li><strong>git diff HEAD</strong></li>
</ul>
</li>
<li>显示两次提交之间的差异<ul>
<li><strong>git diff [first-branch]…[second-branch]</strong></li>
</ul>
</li>
<li>显示今天你写了多少行代码<ul>
<li><strong>git diff –shortstat “@{0 day ago}”</strong></li>
</ul>
</li>
<li>显示某次提交的元数据和内容变化<ul>
<li><strong>git show [commit]</strong></li>
</ul>
</li>
<li>显示某次提交发生变化的文件<ul>
<li><strong>git show –name-only [commit]</strong></li>
</ul>
</li>
<li>显示某次提交时，某个文件的内容<ul>
<li><strong>git show [commit]:[filename]</strong></li>
</ul>
</li>
<li>显示当前分支的最近几次提交<ul>
<li><strong>git reflog</strong></li>
</ul>
</li>
</ul>
</li>
<li><p>远程同步</p>
<ul>
<li>下载远程仓库的所有变动<ul>
<li><strong>git fetch [remote]</strong></li>
</ul>
</li>
<li>显示所有远程仓库<ul>
<li><strong>git remote -v</strong></li>
</ul>
</li>
<li>显示某个远程仓库的信息<ul>
<li><strong>git remote show [remote]</strong></li>
</ul>
</li>
<li>增加一个新的远程仓库，并命名<ul>
<li><strong>git remote add [shortname] [url]</strong></li>
</ul>
</li>
<li>取回远程仓库的变化，并与本地分支合并<ul>
<li><strong>git pull [remote] [branch]</strong></li>
</ul>
</li>
<li>上传本地指定分支到远程仓库<ul>
<li><strong>git push [remote] [branch]</strong></li>
</ul>
</li>
<li>强行推送当前分支到远程仓库，即使有冲突<ul>
<li><strong>git push [remote] –force</strong></li>
</ul>
</li>
<li>推送所有分支到远程仓库<ul>
<li><strong>git push [remote] –all</strong></li>
</ul>
</li>
</ul>
</li>
<li><p>撤销</p>
<ul>
<li>恢复暂存区的指定文件到工作区<ul>
<li><strong>git checkout [file]</strong></li>
</ul>
</li>
<li>恢复某个commit的指定文件到暂存区和工作区<ul>
<li><strong>git checkout [commit] [file]</strong></li>
</ul>
</li>
<li>恢复暂存区的所有文件到工作区<ul>
<li><strong>git checkout .</strong></li>
</ul>
</li>
<li>重置暂存区的指定文件，与上一次commit保持一致，但工作区不变<ul>
<li><strong>git reset [file]</strong></li>
</ul>
</li>
<li>重置暂存区与工作区，与上一次commit保持一致<ul>
<li><strong>git reset –hard</strong></li>
</ul>
</li>
<li>重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变<ul>
<li><strong>git reset [commit]</strong></li>
</ul>
</li>
<li>重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致<ul>
<li><strong>git reset –hard [commit]</strong></li>
</ul>
</li>
<li>重置当前HEAD为指定commit，但保持暂存区和工作区不变<ul>
<li><strong>git reset –keep [commit]</strong></li>
</ul>
</li>
<li>新建一个commit，用来撤销指定commit，后者的所有变化都将被前者抵消，并且应用到当前分支<ul>
<li><strong>git revert [commit]</strong></li>
</ul>
</li>
<li>暂时将未提交的变化移除，稍后再移入<ul>
<li><strong>git stash</strong></li>
<li><strong>git stash pop</strong></li>
</ul>
</li>
</ul>
</li>
<li><p>其他</p>
<ul>
<li>生成一个可供发布的压缩包<ul>
<li><strong>git archive</strong></li>
</ul>
</li>
<li>grep查找<ul>
<li>git grep [-n显示行号] xxxx</li>
</ul>
</li>
</ul>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/10/2017-03-10-Launcher3基础-adb命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JamesWong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JamesWong's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/10/2017-03-10-Launcher3基础-adb命令/" itemprop="url">Launcher3基础 adb命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-10T10:17:40+08:00">
                2017-03-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="2017-3-10-10-17"><a href="#2017-3-10-10-17" class="headerlink" title="2017/3/10 10:17"></a>2017/3/10 10:17</h2><p>##### </p>
<h2 id="今日概要"><a href="#今日概要" class="headerlink" title="今日概要"></a>今日概要</h2><ol>
<li><strong>回顾昨日知识点</strong></li>
<li><strong>了解Launcher</strong></li>
<li><strong>adb命令</strong></li>
</ol>
<h2 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h2><h3 id="Launcher"><a href="#Launcher" class="headerlink" title="Launcher"></a>Launcher</h3><ol>
<li>Framework启动Launcher流程<ul>
<li><img src="http://i.imgur.com/4yLgYys.png" alt=""></li>
</ul>
</li>
<li>PackageManger管理类<ul>
<li>负责管理应用程序包，可以通过它获取应用程序信息，通过getPacageManager方法得到这个类</li>
<li>ResolveInfo：这个类是通过解析一个与IntentFilter相对应的intent得到的信息。它部分地对应于从AndroidManifest.xml的<intent>标签收集到的信息。</intent></li>
</ul>
</li>
<li>简易LauncherDemo步骤<ol>
<li>搭建两个布局：主界面（GridView）、item布局（图标、app名称）</li>
<li>Launcher.java<ol>
<li>获取PackageManger</li>
<li>通过action获取intent<ul>
<li>Intent mainIntent = new Intent(Intent.ACTION_MAIN, null);<br>mainIntent.addCategory(Intent.CATEGORY_LAUNCHER); </li>
</ul>
</li>
<li>根据intent查处所有app信息<ul>
<li>mAllApps = mPackageManager.queryIntentActivities(mainIntent, 0); </li>
</ul>
</li>
<li>设置到GridView上</li>
<li>给item添加点击时间<ul>
<li>通过ResoveInfo获取目标app的包名和入口Activity</li>
<li>用ComponentName启动app</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
<li>CellLayout：存放大小不一的控件</li>
</ol>
<h3 id="adb命令-Android-Debug-Bridge"><a href="#adb命令-Android-Debug-Bridge" class="headerlink" title="adb命令(Android Debug Bridge)"></a>adb命令(Android Debug Bridge)</h3><ol>
<li>常用命令<ul>
<li>查看设备<ul>
<li>adb devices</li>
</ul>
</li>
<li>安装apk<ul>
<li>adb install [-r重新安装，-s安装到sd卡] [路径]</li>
</ul>
</li>
<li>卸载软件<ul>
<li>adb uninstall [-k删除配置和缓存] [软件名com.jameswong.demo]</li>
</ul>
</li>
<li>进入设备或模拟器的shell<ul>
<li>adb shell</li>
<li>adb shell [command]：adb shell dmesg会打印出内核的调试信息</li>
</ul>
</li>
<li>从电脑发送文件到设备<ul>
<li>adb push [本地路径] [远程路径]</li>
</ul>
</li>
<li>从设备下载文件到电脑<ul>
<li>adb pull [远程路径] [本地路径]</li>
</ul>
</li>
<li>查看bug报告<ul>
<li>adb bugreport</li>
</ul>
</li>
<li>启动Server<ul>
<li>adb start-server</li>
</ul>
</li>
<li>停止Server<ul>
<li>adb kill-server</li>
</ul>
</li>
<li>清除应用数据与缓存<ul>
<li>adb shell pm clear [packagename]</li>
</ul>
</li>
<li>启动应用<ul>
<li>adb shell am start -n com.stormzhang.demo/.ui.SplashActivity</li>
</ul>
</li>
<li>强制停止应用<ul>
<li>adb shell am force-stop <packagename></packagename></li>
</ul>
</li>
<li>查看日志<ul>
<li>adb logcat</li>
</ul>
</li>
<li>重启<ul>
<li>adb reboot</li>
</ul>
</li>
<li>获取root权限<ul>
<li>adb root</li>
</ul>
</li>
<li>重新挂载系统分区<ul>
<li>adb remount</li>
</ul>
</li>
<li>获取序列号<ul>
<li>adb get-serialno</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h2><ol>
<li><strong>Dalvik</strong>与<strong>ART(Android runtime)</strong><ul>
<li>Google公司自己设计用于Android平台的Java虚拟机</li>
<li>2014年Google I/O 删除Dalvik，用<strong>ART</strong>替代</li>
<li>区别<ul>
<li><img src="http://i.imgur.com/Z8BJ9HI.png" alt=""></li>
<li><strong>ART模式</strong>：是Android runtime的简称。在ART虚拟机环境下，Android对程序只进行一次编译，就是在程序安装时。在安装应用时，ART虚拟机就先将程序的Java语言转化为适合Android系统运行的机器语言，而且是一次编译终身受用。这样就免于程序每次运行时，都要重新编译的麻烦了，系统的运行效率被大大提高。</li>
<li><strong>Dalvik</strong>：是Google公司自己设计用于Android平台的Java虚拟机。Dalvik虚拟机是Google等厂商合作开发的Android移动设备平台的核心组成部分之一。它可以支持已转换为 .dex（即Dalvik Executable）格式的Java应用程序的运行，.dex格式是专为Dalvik设计的一种压缩格式，适合内存和处理器速度有限的系统。Dalvik 经过优化，允许在有限的内存中同时运行多个虚拟机的实例，并且[1] 每一个Dalvik 应用作为一个独立的Linux 进程执行。独立的进程可以防止在虚拟机崩溃的时候所有程序都被关闭。</li>
</ul>
</li>
</ul>
</li>
<li>onAttachedToWindow()是在onResume()方法之后执行</li>
<li>View中的onFinishInflate()方法<ul>
<li>当View中所有的子控件均被映射成xml后触发，即MyView mv = (MyView)View.inflate (context,R.layout.my_view,null);之后执行</li>
</ul>
</li>
<li>AS查找快捷键<ul>
<li>Ctrl+F：在当前窗口查找文本</li>
<li>Ctrl+Shift+F：在当前工程内查找文本</li>
<li>Ctrl+N：查找类</li>
<li>Ctrl+Shift+N：查找文件</li>
<li>Ctrl+Shift+Alt+N：查找项目中的方法或变量</li>
<li>光标停留类名，右键”Find Usages”(快捷键Alt+F7)：查找类/方法/变量引用的地方</li>
<li>ctrl+F7：该方法在当前类中的被使用到的地方</li>
<li>Ctrl+F12：在类中快速定位某个方法或属性</li>
</ul>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/21/初识Glide图片加载框架/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JamesWong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JamesWong's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/21/初识Glide图片加载框架/" itemprop="url">初识Glide图片加载框架</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-21T08:48:02+08:00">
                2016-10-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###Glide图片加载框架</p>
<p>#####概述</p>
<ol>
<li>Google在2014推出图片加载框架Glide,很多被用于在Google的开源项目中；</li>
<li>Glide和Picasso使用方式基本一样，但是细节有一些区别；</li>
<li>Glide比Picasso加载速度快，但是需要更大的空间来缓存；</li>
<li>可以加载本地资源，assets目录，sd卡，以及网络的图片；</li>
</ol>
<p>#####基本用法</p>
<ul>
<li>导包<ul>
<li>在build.gradle中引入<code>compile &#39;com.github.bumptech.glide:glide:3.7.0&#39;</code></li>
</ul>
</li>
<li>基本语法 <code>Glide.with(context).load(url).into(ImageView中);</code><ul>
<li>加载本地资源：<ul>
<li><code>Glide.with(context).load(R.mipmap.ic_launcher).into(ImageView中)</code></li>
</ul>
</li>
<li>加载assets目录下：<ul>
<li><code>Glide.with(context).load(&quot;file:///android_asset/mm.png&quot;).into(imageview);</code></li>
<li>注意assets目录下地址：<strong>file:///android_asset/图片</strong></li>
</ul>
</li>
<li>加载sd卡下：<ul>
<li><code>Glide.with(context).load(new File(&quot;路径&quot;)).into(imageview);</code></li>
</ul>
</li>
<li>加载网络图片<ul>
<li><code>Glide.with(context).load(url地址).into(imageview);</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>#####常用的设置</p>
<blockquote>
<p>注意：在<strong>DrawableRequestBuilder</strong>类中的一些方法</p>
</blockquote>
<ul>
<li>设置占位图片 <ul>
<li>.placeholder(R.mipmap.ic_launcher).error(R.mipmap.ic_launcher)</li>
<li>用法示例： <code>Glide.with(context).load(url地址).placeholder(R.mipmap.ic_launcher).error(R.mipmap.ic_launcher).into(imageview);</code></li>
</ul>
</li>
<li>淡入淡出的效果<ul>
<li>.crossFade()</li>
</ul>
</li>
<li>无动画效果<ul>
<li>.dontAnimate()</li>
</ul>
</li>
<li>调整大小<ul>
<li>override(width,height)</li>
</ul>
</li>
<li>图片剪裁类型<ul>
<li>centerCrop()</li>
<li>fitCenter()</li>
</ul>
</li>
<li>自定义图形转换<ul>
<li>transForm()</li>
</ul>
</li>
<li>内存缓存，和磁盘的缓存<ul>
<li>skipMemoryCache(true) <ul>
<li>true:不要内存缓存</li>
<li>false:也是默认的，具有内存缓存</li>
</ul>
</li>
<li>diskCacheStrategy(DiskCacheStrategy.ALL)<ul>
<li>DiskCacheStrategy.ALL 缓存所有版本的图片</li>
<li>DiskCacheStrategy.NONE 不做缓存</li>
<li>DiskCacheStrategy.SOURCE 仅仅只缓存原来的分辨率的图像</li>
<li>DiskCacheStrategy.RESULT 仅仅缓存最终的图像，也就是改变大小后的图像</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>######和Picasso的对比</p>
<ol>
<li>with()的区别<ul>
<li><img src="glide/pg.png" alt="picasso"></li>
<li>如果(Activity/Fragment)作为参数<ul>
<li>图片和Activity/Fragment的生命周期保持一致，在Pasuse()状态下停止加载，在Resumed时候又自动加载</li>
</ul>
</li>
</ul>
</li>
<li>图片的显示质量<ul>
<li><img src="glide/02.png" alt="图片质量"></li>
<li>Picasso默认：ARGB8888</li>
<li>Glide默认：RGB565</li>
</ul>
</li>
<li>加载动态Gif图<ul>
<li>Picasso不能加载gif图</li>
<li>Glide加载gif图会消耗过多内存：</li>
</ul>
</li>
<li>缓存策略和加载速度<ul>
<li>Picasso缓存是全尺寸的，而Glide缓存和ImageView的大小一致<ol>
<li>Glide的这种特点让加载速度特别快</li>
<li>Picasso加载时，需要调整大小会有些延迟</li>
</ol>
</li>
</ul>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/20/Week09-day01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JamesWong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JamesWong's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/20/Week09-day01/" itemprop="url">Week09-day01</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-20T17:33:49+08:00">
                2016-10-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Week09-day01"><a href="#Week09-day01" class="headerlink" title="Week09-day01"></a>Week09-day01</h2><p>##### </p>
<h2 id="今日概要"><a href="#今日概要" class="headerlink" title="今日概要"></a>今日概要</h2><ol>
<li><strong>回顾昨日知识点</strong></li>
<li><strong>消息推送</strong>(三方SDK)</li>
<li><strong>三方分享</strong>(三方SDK)</li>
<li><strong>三方登录</strong>(三方SDK)</li>
<li><strong>MVP</strong></li>
</ol>
<h2 id="课程笔记"><a href="#课程笔记" class="headerlink" title="课程笔记"></a>课程笔记</h2><h3 id="消息推送"><a href="#消息推送" class="headerlink" title="消息推送"></a>消息推送</h3><ol>
<li><strong>XMPP</strong>（附Xmind）</li>
<li><p><strong>Jpush快速集成推送</strong>（掌握）：<a href="http://docs.jiguang.cn/" target="_blank" rel="noopener">http://docs.jiguang.cn/</a></p>
<ul>
<li><p>jcenter 自动集成步骤</p>
<ul>
<li><p>说明 ： 使用jcenter自动集成的开发者，不需要在项目中添加jar和so，jcenter会自动完成依赖；在AndroidManifest.xml中不需要添加任何JPush SDK 相关的配置，jcenter会自动导入, 如果手动添加则是以开发者添加的为准覆盖掉默认配置。</p>
<ul>
<li>确认android studio的 Project 根目录的主 gradle 中配置了jcenter支持。（新建project默认配置就支持）</li>
<li><pre><code>buildscript {
    repositories {
        jcenter()
    }
    ......
}

allprojets {
    repositories {
        jcenter()
    }
}    
</code></pre></li>
<li>在 module 的 gradle 中添加依赖和AndroidManifest的替换变量。</li>
<li><pre><code>android {
    ......
    defaultConfig {
        applicationId &quot;com.xxx.xxx&quot; //JPush上注册的包名.
        ......

        ndk {
            //选择要添加的对应cpu类型的.so库。 
            abiFilters &apos;armeabi&apos;, &apos;armeabi-v7a&apos;, &apos;armeabi-v8a&apos; 
            // 还可以添加 &apos;x86&apos;, &apos;x86_64&apos;, &apos;mips&apos;, &apos;mips64&apos;
        }

        manifestPlaceholders = [
            JPUSH_PKGNAME : applicationId,
            JPUSH_APPKEY : &quot;你的appkey&quot;, //JPush上注册的包名对应的appkey.
            JPUSH_CHANNEL : &quot;developer-default&quot;, //暂时填写默认值即可.
        ]
        ......
    }
    ......
}

dependencies {
    ......

    compile &apos;cn.jiguang:jpush:2.1.8&apos;  // 此处以SDK 2.1.8版本为例

    ......
}
</code></pre></li>
</ul>
</li>
<li><p>注 : 如果在添加以上 abiFilter 配置之后android Studio出现以下提示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NDK integration is deprecated in the current plugin. Consider trying the new experimental plugin.</span><br></pre></td></tr></table></figure>
</li>
<li><p>则在 Project 根目录的gradle.properties文件中添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android.useDeprecatedNdk=true.</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>添加代码</p>
<ul>
<li>JPush SDK 提供的 API 接口，都主要集中在 cn.jpush.android.api.JPushInterface 类里。</li>
<li><p>基础API</p>
<ul>
<li><p>init 初始化SDK</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static void init(Context context)</span><br></pre></td></tr></table></figure>
</li>
<li><p>setDebugMode 设置调试模式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// You can enable debug mode in developing state. You should close debug mode when release.</span><br><span class="line">public static void setDebugMode(boolean debugEnalbed)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>调用示例代码（参考 example 项目）</p>
<ul>
<li>init 只需要在应用程序启动时调用一次该 API 即可。</li>
<li>以下代码定制一个本应用程序 Application 类。需要在 AndoridManifest.xml 里配置。请参考上面 AndroidManifest.xml 片断，或者 example 项目。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class ExampleApplication extends Application &#123;</span><br><span class="line">@Override</span><br><span class="line">    public void onCreate() &#123;</span><br><span class="line">        super.onCreate();</span><br><span class="line">        JPushInterface.setDebugMode(true);</span><br><span class="line">        JPushInterface.init(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="3-友盟"><a href="#3-友盟" class="headerlink" title="3. 友盟"></a>3. 友盟</h2><h3 id="集成三方SDK基本通用步骤"><a href="#集成三方SDK基本通用步骤" class="headerlink" title="集成三方SDK基本通用步骤"></a>集成三方SDK基本通用步骤</h3><ol>
<li>1</li>
<li>2</li>
<li>3</li>
<li>4</li>
<li>5</li>
<li>6</li>
<li>7</li>
</ol>
<hr>
<p>###三方分享</p>
<ol>
<li>shareSDK: <a href="http://www.mob.com/" target="_blank" rel="noopener">http://www.mob.com/</a></li>
<li>Umeng</li>
</ol>
<hr>
<h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h2><ol>
<li>复习Socket</li>
<li>CPU主要的三个平台<ol>
<li>ARCH-ARM</li>
<li>ARCH-mips</li>
<li>ARCH-x86</li>
</ol>
</li>
<li>自定义Dialog<ol>
<li>setView</li>
<li>里面的点击事件之类可以暴露方法，设置监听给外部调用</li>
</ol>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/19/Week08-day05/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JamesWong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JamesWong's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/19/Week08-day05/" itemprop="url">Week08-day05</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-19T09:08:11+08:00">
                2016-10-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Week08-day05"><a href="#Week08-day05" class="headerlink" title="Week08-day05"></a>Week08-day05</h2><h5 id="2016-10-19-星期三-9-08-11"><a href="#2016-10-19-星期三-9-08-11" class="headerlink" title="2016/10/19 星期三 9:08:11"></a>2016/10/19 星期三 9:08:11</h5><h2 id="今日概要"><a href="#今日概要" class="headerlink" title="今日概要"></a>今日概要</h2><ol>
<li><strong>回顾昨日知识点</strong></li>
<li><strong>MaterialDesign(附Xmind文档)</strong></li>
<li><strong>刷新的几种方案</strong></li>
<li><strong>MVP(附Xmind文档)</strong></li>
</ol>
<h2 id="课程笔记"><a href="#课程笔记" class="headerlink" title="课程笔记"></a>课程笔记</h2><h3 id="MaterialDesign"><a href="#MaterialDesign" class="headerlink" title="MaterialDesign"></a>MaterialDesign</h3><ol>
<li>SnackBar<ol>
<li>封装颜色背景的类</li>
</ol>
</li>
<li>FloatingActionButton</li>
<li>TextInputLayout(一般结合EditText使用)<pre><code>- ![](http://i.imgur.com/jODmhSu.png)
</code></pre></li>
<li>滚动/过渡布局<ul>
<li><img src="http://i.imgur.com/rkqJgpx.png" alt=""></li>
</ul>
</li>
</ol>
<hr>
<h3 id="刷新的几种方案"><a href="#刷新的几种方案" class="headerlink" title="刷新的几种方案"></a>刷新的几种方案</h3><ol>
<li>SwipeRefreshLayout</li>
<li><p>ultra-pulltorefresh</p>
<ol>
<li><p>导包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;in.srain.cube:ultra-ptr:1.0.11&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加一些属性<img src="http://i.imgur.com/PCEuPtm.png" alt=""></p>
</li>
<li>刷新监听 <img src="http://i.imgur.com/1t4EJJb.png" alt=""></li>
<li><img src="http://i.imgur.com/jEXCJ3C.png" alt=""></li>
</ol>
</li>
</ol>
<hr>
<p>###MVC、MVP模式（附Xmind文档：Week08_05 2.xmind）</p>
<ol>
<li>MVC模式<ol>
<li>MVC（Model-View-Controller）是最常见的软件架构之一，业界有着广泛应用</li>
<li><img src="http://i.imgur.com/noFQeKg.png" alt=""></li>
</ol>
</li>
<li>MVP模式：<strong>Model</strong>(数据访问层)-<strong>Presenter</strong>(业务逻辑处理)-<strong>View</strong>(展示数据,对用户行为做出反馈)<ol>
<li>优点<ul>
<li>易于维护</li>
<li>易于测试</li>
<li>松耦合度</li>
<li>复用性高</li>
<li>健壮稳定</li>
</ul>
</li>
<li><img src="http://i.imgur.com/PL4aa4U.png" alt=""></li>
<li><img src="http://i.imgur.com/nLY5KTM.png" alt=""></li>
</ol>
</li>
</ol>
<hr>
<h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h2><ol>
<li><p>代码中颜色转换</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Color.parseColor(#RRGGBB/#AARRGGBB)</span><br></pre></td></tr></table></figure>
</li>
<li><p>$表示内部</p>
<ul>
<li><img src="http://i.imgur.com/PdSqafs.png" alt=""></li>
</ul>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/18/AndroidStudio模版编写/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JamesWong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JamesWong's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/18/AndroidStudio模版编写/" itemprop="url">AndroidStudio代码模版编写</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-18T21:11:37+08:00">
                2016-10-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Week08-day02"><a href="#Week08-day02" class="headerlink" title="Week08-day02"></a>Week08-day02</h2><h5 id="2016-10-18-星期二-21-11-37"><a href="#2016-10-18-星期二-21-11-37" class="headerlink" title="2016/10/18 星期二 21:11:37"></a>2016/10/18 星期二 21:11:37</h5><ol>
<li><strong>*创建BaseAdapter适配器中的getView</strong><ul>
<li><img src="http://i.imgur.com/xm028Z2.png" alt=""></li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ViewHolder holder = null;</span><br><span class="line">if ($convertView$ == null) &#123;</span><br><span class="line">    $convertView$ = LayoutInflater.from($context$).inflate(R.layout.$layout$,parent$root$,false);</span><br><span class="line">    holder = new ViewHolder($convertView$);</span><br><span class="line">    $convertView$.setTag(holder);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    holder = (ViewHolder) $convertView$.getTag();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>*创建有参数的Fragment实例</strong><ul>
<li><img src="http://i.imgur.com/MjWHgI2.png" alt=""></li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public static $className$ newInstance()&#123;</span><br><span class="line">    </span><br><span class="line">    $className$ mFragment = new $className$();</span><br><span class="line">    Bundle bundle = new Bundle();</span><br><span class="line">    // 存要传入的数据</span><br><span class="line">    </span><br><span class="line">    mFragment.setArguments(bundle);</span><br><span class="line">    return mFragment;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>下面是系统提供的<ul>
<li><img src="http://i.imgur.com/KCSGDbe.png" alt=""></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public static $fragment$ newInstance($args$) &#123;</span><br><span class="line">    $nullChecks$</span><br><span class="line">    android.os.Bundle args = new Bundle();</span><br><span class="line">    $addArgs$</span><br><span class="line">    $fragment$ fragment = new $fragment$();</span><br><span class="line">    fragment.setArguments(args);</span><br><span class="line">    return fragment;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>*创建双重校验锁的单例模式对象</strong><ul>
<li><img src="http://i.imgur.com/zw49nz7.png" alt=""></li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">private static $className$ mInstance = null;</span><br><span class="line">// 双重校验锁单例模式</span><br><span class="line">public static synchronized $className$ getInstance(Context context)&#123;</span><br><span class="line">    if(mInstance==null)&#123;</span><br><span class="line">        synchronized ($className$.class)</span><br><span class="line">        &#123;</span><br><span class="line">            if (mInstance == null)</span><br><span class="line">                mInstance = new $className$(context);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return mInstance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>自定义控件的3个构造方法</strong><ul>
<li><img src="http://i.imgur.com/PwKdB6e.png" alt=""></li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public $class$(android.content.Context context) &#123;</span><br><span class="line">    this(context, null);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public $class$(Context context, android.util.AttributeSet attrs) &#123;</span><br><span class="line">    this(context, attrs, 0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public $class$(Context context, AttributeSet attrs, int defStyle) &#123;</span><br><span class="line">    super(context, attrs, defStyle);</span><br><span class="line">    $cursor$</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>*三目表达式</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$item$ == null ? 0$position1$ : $position2$</span><br></pre></td></tr></table></figure>
<ol>
<li>*switch</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">switch($view$.getId())&#123;</span><br><span class="line">    case $case1$:</span><br><span class="line">        break;</span><br><span class="line">    case $case2$:</span><br><span class="line">        break;</span><br><span class="line">    default:</span><br><span class="line">        break;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/18/Week08-day04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JamesWong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JamesWong's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/18/Week08-day04/" itemprop="url">Week08-day04</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-18T09:01:27+08:00">
                2016-10-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Week08-day04"><a href="#Week08-day04" class="headerlink" title="Week08-day04"></a>Week08-day04</h2><h5 id="2016-10-18-星期二-9-01-27"><a href="#2016-10-18-星期二-9-01-27" class="headerlink" title="2016/10/18 星期二 9:01:27"></a>2016/10/18 星期二 9:01:27</h5><h2 id="今日概要"><a href="#今日概要" class="headerlink" title="今日概要"></a>今日概要</h2><ol>
<li><strong>回顾Picasso框架、ViewPagerIndicator</strong></li>
<li><strong>视频播放</strong></li>
<li><strong>数据库框架</strong></li>
</ol>
<hr>
<h3 id="修改Picasso使用OkHttp3的下载器"><a href="#修改Picasso使用OkHttp3的下载器" class="headerlink" title="修改Picasso使用OkHttp3的下载器"></a>修改Picasso使用OkHttp3的下载器</h3><ol>
<li>用默认的2.x的OkHttp</li>
<li>自己写基于Okhttp3的OkHttpDownloader</li>
</ol>
<hr>
<h3 id="视频播放"><a href="#视频播放" class="headerlink" title="视频播放"></a>视频播放</h3><ol>
<li><strong>VideoView</strong><ol>
<li>放raw目录下</li>
</ol>
</li>
<li><strong>MediaPlayer+SurfaceView</strong><ol>
<li>放assets目录下</li>
<li><img src="http://i.imgur.com/A8ErzfG.png" alt=""><ul>
<li>双缓冲：帧动画，开启新线程提前画好下一帧，然后不擦除，直接替换</li>
</ul>
</li>
<li><img src="http://i.imgur.com/MyveLA3.png" alt=""></li>
<li><img src="http://i.imgur.com/eQzlF6g.png" alt=""></li>
</ol>
</li>
<li><p><strong>三方框架：Vitamio</strong></p>
<ol>
<li><p>在清单配置文件中注册Vitamiosdk</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Don&apos;t forgot InitActivity --&gt;</span><br><span class="line">        &lt;activity</span><br><span class="line">            android:name=&quot;io.vov.vitamio.activity.InitActivity&quot;</span><br><span class="line">            android:configChanges=&quot;orientation|screenSize|smallestScreenSize|keyboard|keyboardHidden|navigation&quot;</span><br><span class="line">            android:launchMode=&quot;singleTop&quot;</span><br><span class="line">            android:theme=&quot;@android:style/Theme.NoTitleBar&quot;</span><br><span class="line">            android:windowSoftInputMode=&quot;stateAlwaysHidden&quot; /&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>初始化vitamio的sdk</p>
<ul>
<li><img src="http://i.imgur.com/9oIGR3R.png" alt=""></li>
</ul>
</li>
<li><img src="http://i.imgur.com/ahHyDLf.png" alt=""></li>
<li><img src="http://i.imgur.com/3GVX9f4.png" alt=""></li>
<li><img src="http://i.imgur.com/zTDl0wg.png" alt=""></li>
<li><img src="http://i.imgur.com/ifdxRhn.png" alt=""></li>
</ol>
</li>
</ol>
<hr>
<p>###数据库框架</p>
<p>####ORMLite框架（基于ORM的数据库框架）:ORM：对象 - 关系 映射,即一个对象 对应 数据库中一个表</p>
<pre><code>1. 导包
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.j256.ormlite:ormlite-android:5.0&apos;</span><br></pre></td></tr></table></figure>

2. 创建一个数据库帮助类继承OrmLiteSqliteOpenHelper（单例）
    - ![](http://i.imgur.com/fjUZXcE.png)
3. 创建对象类，一定要有一个无参构造方法
    - ![](http://i.imgur.com/YzBcB8f.png)
4. 在帮助类创建表
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">            //创建一张Person表</span><br><span class="line">            TableUtils.createTable(connectionSource,Person.class);</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

5. 一个表对应一个Dao，在帮助类中写一个暴露的方法，获得即数据库的业务类，里面会封装CURD的方法
    - ![](http://i.imgur.com/rwAZMNA.png)
6. 插入一条数据
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">private void insertData() &#123;</span><br><span class="line">        //插入一条数据</span><br><span class="line">        int age = (int) (Math.random() * 100);</span><br><span class="line">        Person person = new Person(&quot;hjj&quot;, age, &quot;zz一枚&quot;);</span><br><span class="line">        try &#123;</span><br><span class="line">            mPersonDao.createIfNotExists(person);</span><br><span class="line"></span><br><span class="line">            mAdapeter.setData(queryAllData());</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

7. 删除一条数据
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">private void deleteData() &#123;</span><br><span class="line">        if (queryAllData() != null) &#123;</span><br><span class="line">            Person person = queryAllData().get(0);</span><br><span class="line">            try &#123;</span><br><span class="line">                mPersonDao.delete(person);</span><br><span class="line">                mAdapeter.setData(queryAllData());</span><br><span class="line">            &#125; catch (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

8. 查询
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Person&gt; data = mPersonDao.queryBuilder().where().like(&quot;age&quot;, s + &quot;%&quot;).query();</span><br></pre></td></tr></table></figure>
</code></pre><hr>
<h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h2><ol>
<li>GC会优先回收null的对象</li>
<li>View的手势监听<ul>
<li><img src="http://i.imgur.com/4GOxn9g.png" alt=""></li>
<li><img src="http://i.imgur.com/JlqXO6F.png" alt=""></li>
</ul>
</li>
<li>记一些常见的异常<ol>
<li>NullPointerException - 空指针引用异常<br>ClassCastException - 类型强制转换异常。<br>IllegalArgumentException - 传递非法参数异常。<br>ArithmeticException - 算术运算异常<br>ArrayStoreException - 向数组中存放与声明类型不兼容对象异常<br>IndexOutOfBoundsException - 下标越界异常<br>NegativeArraySizeException - 创建一个大小为负数的数组错误异常<br>NumberFormatException - 数字格式异常<br>SecurityException - 安全异常<br>UnsupportedOperationException - 不支持的操作异常</li>
<li>算术异常类：ArithmeticExecption<br>空指针异常类：NullPointerException<br>类型强制转换异常：ClassCastException<br>数组负下标异常：NegativeArrayException<br>数组下标越界异常：ArrayIndexOutOfBoundsException<br>违背安全原则异常：SecturityException<br>文件已结束异常：EOFException<br>文件未找到异常：FileNotFoundException<br>字符串转换为数字异常：NumberFormatException<br>操作数据库异常：SQLException<br>输入输出异常：IOException<br>方法未找到异常：NoSuchMethodException<br>Java.lang.AbstractMethodError<br>抽象方法错误。当应用试图调用抽象方法时抛出。</li>
</ol>
</li>
</ol>
<p>java.lang.AssertionError<br>断言错。用来指示一个断言失败的情况。</p>
<p>java.lang.ClassCircularityError<br>类循环依赖错误。在初始化一个类时，若检测到类之间循环依赖则抛出该异常。</p>
<p>java.lang.ClassFormatError<br>类格式错误。当Java虚拟机试图从一个文件中读取Java类，而检测到该文件的内容不符合类的有效格式时抛出。</p>
<p>java.lang.Error<br>错误。是所有错误的基类，用于标识严重的程序运行问题。这些问题通常描述一些不应被应用程序捕获的反常情况。</p>
<p>java.lang.ExceptionInInitializerError<br>初始化程序错误。当执行一个类的静态初始化程序的过程中，发生了异常时抛出。静态初始化程序是指直接包含于类中的static语句段。</p>
<p>java.lang.IllegalAccessError<br>违法访问错误。当一个应用试图访问、修改某个类的域（Field）或者调用其方法，但是又违反域或方法的可见性声明，则抛出该异常。</p>
<p>java.lang.IncompatibleClassChangeError<br>不兼容的类变化错误。当正在执行的方法所依赖的类定义发生了不兼容的改变时，抛出该异常。一般在修改了应用中的某些类的声明定义而没有对整个应用重新编译而直接运行的情况下，容易引发该错误。</p>
<p>java.lang.InstantiationError<br>实例化错误。当一个应用试图通过Java的new操作符构造一个抽象类或者接口时抛出该异常.</p>
<p>java.lang.InternalError<br>内部错误。用于指示Java虚拟机发生了内部错误。</p>
<p>java.lang.LinkageError<br>链接错误。该错误及其所有子类指示某个类依赖于另外一些类，在该类编译之后，被依赖的类改变了其类定义而没有重新编译所有的类，进而引发错误的情况。</p>
<p>java.lang.NoClassDefFoundError<br>未找到类定义错误。当Java虚拟机或者类装载器试图实例化某个类，而找不到该类的定义时抛出该错误。</p>
<p>java.lang.NoSuchFieldError<br>域不存在错误。当应用试图访问或者修改某类的某个域，而该类的定义中没有该域的定义时抛出该错误。</p>
<p>java.lang.NoSuchMethodError<br>方法不存在错误。当应用试图调用某类的某个方法，而该类的定义中没有该方法的定义时抛出该错误。</p>
<p>java.lang.OutOfMemoryError<br>内存不足错误。当可用内存不足以让Java虚拟机分配给一个对象时抛出该错误。</p>
<p>java.lang.StackOverflowError<br>堆栈溢出错误。当一个应用递归调用的层次太深而导致堆栈溢出时抛出该错误。</p>
<p>java.lang.ThreadDeath<br>线程结束。当调用Thread类的stop方法时抛出该错误，用于指示线程结束。</p>
<p>java.lang.UnknownError<br>未知错误。用于指示Java虚拟机发生了未知严重错误的情况。</p>
<p>java.lang.UnsatisfiedLinkError<br>未满足的链接错误。当Java虚拟机未找到某个类的声明为native方法的本机语言定义时抛出。</p>
<p>java.lang.UnsupportedClassVersionError<br>不支持的类版本错误。当Java虚拟机试图从读取某个类文件，但是发现该文件的主、次版本号不被当前Java虚拟机支持的时候，抛出该错误。</p>
<p>java.lang.VerifyError<br>验证错误。当验证器检测到某个类文件中存在内部不兼容或者安全问题时抛出该错误。</p>
<p>java.lang.VirtualMachineError<br>虚拟机错误。用于指示虚拟机被破坏或者继续执行操作所需的资源不足的情况。</p>
<p>java.lang.ArithmeticException<br>算术条件异常。譬如：整数除零等。</p>
<p>java.lang.ArrayIndexOutOfBoundsException<br>数组索引越界异常。当对数组的索引值为负数或大于等于数组大小时抛出。</p>
<p>java.lang.ArrayStoreException<br>数组存储异常。当向数组中存放非数组声明类型对象时抛出。</p>
<p>java.lang.ClassCastException<br>类造型异常。假设有类A和B（A不是B的父类或子类），O是A的实例，那么当强制将O构造为类B的实例时抛出该异常。该异常经常被称为强制类型转换异常。</p>
<p>java.lang.ClassNotFoundException<br>找不到类异常。当应用试图根据字符串形式的类名构造类，而在遍历CLASSPAH之后找不到对应名称的class文件时，抛出该异常。</p>
<p>java.lang.CloneNotSupportedException<br>不支持克隆异常。当没有实现Cloneable接口或者不支持克隆方法时,调用其clone()方法则抛出该异常。</p>
<p>java.lang.EnumConstantNotPresentException<br>枚举常量不存在异常。当应用试图通过名称和枚举类型访问一个枚举对象，但该枚举对象并不包含常量时，抛出该异常。</p>
<p>java.lang.Exception<br>根异常。用以描述应用程序希望捕获的情况。</p>
<p>java.lang.IllegalAccessException<br>违法的访问异常。当应用试图通过反射方式创建某个类的实例、访问该类属性、调用该类方法，而当时又无法访问类的、属性的、方法的或构造方法的定义时抛出该异常。</p>
<p>java.lang.IllegalMonitorStateException<br>违法的监控状态异常。当某个线程试图等待一个自己并不拥有的对象（O）的监控器或者通知其他线程等待该对象（O）的监控器时，抛出该异常。</p>
<p>java.lang.IllegalStateException<br>违法的状态异常。当在Java环境和应用尚未处于某个方法的合法调用状态，而调用了该方法时，抛出该异常。</p>
<p>java.lang.IllegalThreadStateException<br>违法的线程状态异常。当县城尚未处于某个方法的合法调用状态，而调用了该方法时，抛出异常。</p>
<p>java.lang.IndexOutOfBoundsException<br>索引越界异常。当访问某个序列的索引值小于0或大于等于序列大小时，抛出该异常。</p>
<p>java.lang.InstantiationException<br>实例化异常。当试图通过newInstance()方法创建某个类的实例，而该类是一个抽象类或接口时，抛出该异常。</p>
<p>java.lang.InterruptedException<br>被中止异常。当某个线程处于长时间的等待、休眠或其他暂停状态，而此时其他的线程通过Thread的interrupt方法终止该线程时抛出该异常。</p>
<p>java.lang.NegativeArraySizeException<br>数组大小为负值异常。当使用负数大小值创建数组时抛出该异常。</p>
<p>java.lang.NoSuchFieldException<br>属性不存在异常。当访问某个类的不存在的属性时抛出该异常。</p>
<p>java.lang.NoSuchMethodException<br>方法不存在异常。当访问某个类的不存在的方法时抛出该异常。</p>
<p>java.lang.NullPointerException<br>空指针异常。当应用试图在要求使用对象的地方使用了null时，抛出该异常。譬如：调用null对象的实例方法、访问null对象的属性、计算null对象的长度、使用throw语句抛出null等等。</p>
<p>java.lang.NumberFormatException<br>数字格式异常。当试图将一个String转换为指定的数字类型，而该字符串确不满足数字类型要求的格式时，抛出该异常。</p>
<p>java.lang.RuntimeException<br>运行时异常。是所有Java虚拟机正常操作期间可以被抛出的异常的父类。</p>
<p>java.lang.SecurityException<br>安全异常。由安全管理器抛出，用于指示违反安全情况的异常。</p>
<p>java.lang.StringIndexOutOfBoundsException<br>字符串索引越界异常。当使用索引值访问某个字符串中的字符，而该索引值小于0或大于等于序列大小时，抛出该异常。</p>
<p>java.lang.TypeNotPresentException<br>类型不存在异常。当应用试图以某个类型名称的字符串表达方式访问该类型，但是根据给定的名称又找不到该类型是抛出该异常。该异常与ClassNotFoundException的区别在于该异常是unchecked（不被检查）异常，而ClassNotFoundException是checked（被检查）异常。</p>
<p>java.lang.UnsupportedOperationException<br>不支持的方法异常。指明请求的方法不被支持情况的异常。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/17/Week08-day03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JamesWong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JamesWong's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/17/Week08-day03/" itemprop="url">Week08-day03</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-17T09:01:28+08:00">
                2016-10-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Week08-day03"><a href="#Week08-day03" class="headerlink" title="Week08-day03"></a>Week08-day03</h2><h5 id="2016-10-17-星期一-9-01-28"><a href="#2016-10-17-星期一-9-01-28" class="headerlink" title="2016/10/17 星期一 9:01:28"></a>2016/10/17 星期一 9:01:28</h5><h2 id="今日概要"><a href="#今日概要" class="headerlink" title="今日概要"></a>今日概要</h2><ol>
<li><strong>作业</strong></li>
<li><strong>Picasso</strong></li>
<li><strong>视频或者数据库</strong></li>
</ol>
<h3 id="Picasso"><a href="#Picasso" class="headerlink" title="Picasso"></a>Picasso</h3><ol>
<li><p>最基本的使用方式：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Picasso.with(context).load(&quot;http://i.imgur.com/DvpvklR.png&quot;).into(imageView);</span><br><span class="line">Picasso.with(context).load(R.drawable.landing_screen).into(imageView1);</span><br><span class="line">Picasso.with(context).load(&quot;file:///android_asset/DvpvklR.png&quot;).into(imageView2);</span><br><span class="line">Picasso.with(context).load(new File(...)).into(imageView3);</span><br></pre></td></tr></table></figure>
<ul>
<li><img src="http://i.imgur.com/0GRFPon.png" alt=""></li>
</ul>
</li>
<li><p>添加加载中、加载失败的图片显示</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Picasso.with(context)</span><br><span class="line">    .load(url)</span><br><span class="line">    .placeholder(R.drawable.user_placeholder)</span><br><span class="line">    .error(R.drawable.user_placeholder_error)</span><br><span class="line">    .into(imageView);</span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义图形转换</p>
</li>
<li>Application中进行全局配置<ul>
<li><img src="http://i.imgur.com/RAa8y8r.png" alt=""></li>
<li><img src="http://i.imgur.com/vZQwePW.png" alt=""></li>
</ul>
</li>
</ol>
<h3 id="ViewPagerIndicator（JakeWharton）"><a href="#ViewPagerIndicator（JakeWharton）" class="headerlink" title="ViewPagerIndicator（JakeWharton）"></a>ViewPagerIndicator（JakeWharton）</h3><p>1.在attrs下看自定义属性</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/13/Week08-day01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JamesWong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JamesWong's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/13/Week08-day01/" itemprop="url">Week08-day01</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-13T09:16:14+08:00">
                2016-10-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Week08-day01"><a href="#Week08-day01" class="headerlink" title="Week08-day01"></a>Week08-day01</h2><h5 id="2016-10-13-星期四-9-16-14"><a href="#2016-10-13-星期四-9-16-14" class="headerlink" title="2016/10/13 星期四 9:16:14"></a>2016/10/13 星期四 9:16:14</h5><h2 id="今日概要"><a href="#今日概要" class="headerlink" title="今日概要"></a>今日概要</h2><ol>
<li><strong>回顾Http协议</strong></li>
<li><strong>OKHttp3</strong></li>
<li><strong>Picasso</strong></li>
</ol>
<h3 id="Http协议"><a href="#Http协议" class="headerlink" title="Http协议"></a>Http协议</h3><ol>
<li>Android中通信常用方式（<strong>两种</strong>）<ol>
<li>一种基于<strong>Http</strong>协议<ul>
<li>下方详情：<strong>HTTP协议你所需要知道的</strong></li>
<li>Http协议基于请求响应模式：服务端高冷，要客户端向服务器请求</li>
<li>三次握手<ul>
<li><img src="http://i.imgur.com/OC4uLad.png" alt=""></li>
<li><img src="http://i.imgur.com/SwttWre.gif" alt=""></li>
</ul>
</li>
</ul>
</li>
<li>一种基于<strong>Socket</strong>协议</li>
<li>OKHttpDemo<ol>
<li><strong>Get请求</strong><ul>
<li><strong>同步请求方式</strong>：<ul>
<li><img src="http://i.imgur.com/KDukRrM.png" alt=""></li>
<li><img src="http://i.imgur.com/tHSwOGa.png" alt=""></li>
<li><img src="http://i.imgur.com/yLply08.png" alt=""></li>
</ul>
</li>
<li><strong>异步请求方式</strong><ul>
<li><img src="http://i.imgur.com/lG9DTy8.png" alt=""></li>
<li>注意runOnUiThread()<img src="http://i.imgur.com/qjhvMv4.png" alt=""></li>
</ul>
</li>
</ul>
</li>
<li><strong>Post请求</strong><img src="http://i.imgur.com/wLIZ2Yh.png" alt=""><ul>
<li>同步请求方式<ul>
<li>普通请求<img src="http://i.imgur.com/Ti0obvr.png" alt=""></li>
<li>json请求</li>
</ul>
</li>
<li>异步请求方式<ul>
<li><img src="http://i.imgur.com/BFLmmFf.png" alt=""></li>
</ul>
</li>
</ul>
</li>
<li><strong>下载</strong><ul>
<li><img src="http://i.imgur.com/JDqLfrU.png" alt=""></li>
</ul>
</li>
<li><strong>在文件系统中开启响应缓存</strong><ul>
<li><img src="http://i.imgur.com/7YrRo5Z.png" alt=""></li>
<li>（2.0版本）</li>
<li><img src="http://i.imgur.com/D5dqJ3Q.png" alt=""> </li>
</ul>
</li>
<li><strong>指定超时时间</strong><ul>
<li>连接超时15s</li>
<li>读写超时20s</li>
<li>（2.0版本）</li>
<li><img src="http://i.imgur.com/C2sFNcX.png" alt=""></li>
</ul>
</li>
<li><strong>设置tag标记</strong><ul>
<li>在request中设置tag</li>
<li>遍历call的两个队列，取消对应request的tag的call的请求<ul>
<li><img src="http://i.imgur.com/ZO0oDQD.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<hr>
<h3 id="Android-studio模版修改"><a href="#Android-studio模版修改" class="headerlink" title="Android studio模版修改"></a>Android studio模版修改</h3><ol>
<li>Android studio安装目录—&gt;plugins—&gt;android—&gt;lib—&gt;templates—&gt;gradle-projects(<strong>先备份</strong>)—&gt;NewAndroidProject—&gt;root<ul>
<li><img src="http://i.imgur.com/YDZOgzI.png" alt=""></li>
<li><code>//新添加的ButterKnife的apt的插件</code></li>
<li><code>classpath &#39;com.neenbedankt.gradle.plugins:android-apt:1.8&#39;</code></li>
</ul>
</li>
<li>…—&gt;NewAndroidModule—&gt;root<ul>
<li><img src="http://i.imgur.com/bH48opI.png" alt=""></li>
<li><code>//添加了 引入：apt插件</code></li>
<li><code>apply plugin: &#39;android-apt&#39;</code></li>
<li><img src="http://i.imgur.com/NvXfvGp.png" alt=""></li>
<li><code>//butterknife的包的导入</code></li>
<li><code>compile &#39;com.jakewharton:butterknife:8.4.0&#39;</code></li>
<li><code>apt &#39;com.jakewharton:butterknife-compiler:8.4.0&#39;</code></li>
</ul>
</li>
</ol>
<hr>
<h2 id="HTTP协议你所需要知道的（扩展）"><a href="#HTTP协议你所需要知道的（扩展）" class="headerlink" title="##HTTP协议你所需要知道的（扩展）"></a>##HTTP协议你所需要知道的（扩展）</h2><h3 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h3><ul>
<li>虽然现在已经有很多的开源库帮助我们可以轻而易举的访问网络,  但是我们还是得知道HTTP协议原理。</li>
</ul>
<p>###Http简介</p>
<ul>
<li>HTTP是一个属于应用层的面向对象的协议，由于其简捷、快速的方式，适用于分布式超媒体信息系统。它于1990年提出，经过几年的使用与发展，得到不断地完善和扩展。</li>
<li>基于TCP的协议</li>
<li>HTTP默认端口号：80</li>
<li>端口：<ul>
<li>TCP 0–65535,建议0–1024预留给操作系统，</li>
<li>UDP 0–65535,</li>
</ul>
</li>
<li><code>HTTP协议基于请求响应模式</code><ul>
<li>必须先发送请求，服务器才能做出响应</li>
<li>请求与响应成对的</li>
</ul>
</li>
<li>HTTP协议的版本<ul>
<li>HTTP/1.1  建立一个连接，可以发送多次请求</li>
<li>HTTP/1.0  建立一个连接，发送一次请求，断开连接</li>
</ul>
</li>
</ul>
<p>###HTTP请求</p>
<pre><code>- Http请求行，请求头，请求体
</code></pre><ul>
<li>请求行<ul>
<li>格式： 请求方式  请求资源路径                协议/版本号</li>
<li>例如： GET     /video/2015/0709/_wpd.mp4 HTTP/1.1<ul>
<li>请求方式 Http协议提供了7种方式，常用的有两种get,post</li>
<li>get:将请求参数追加的url之后，传递到服务器<ul>
<li>例如：<a href="http://***//video/2015/0709/_wpd.mp4?username=1&amp;page=1&amp;size=10" target="_blank" rel="noopener">http://***//video/2015/0709/_wpd.mp4?username=1&amp;page=1&amp;size=10</a>;</li>
</ul>
</li>
<li>post:将请求参数放置请求体重，用户看不到：所以安全，可以传递大量数据</li>
</ul>
</li>
</ul>
</li>
<li>请求头<ul>
<li>Accept:text/html,image/*    – 支持的数据类型<ul>
<li>MIME类型格式：大类型/小类型;例如text/html,text/css,text/javascript</li>
<li>image;application;Video;Audio;message;multipart等等</li>
</ul>
</li>
</ul>
<ul>
<li>Accept-Encoding:gzip        – 支持压缩格式</li>
<li>Host:<a href="http://www.alex.com" target="_blank" rel="noopener">http://www.alex.com</a> –访问的主机</li>
</ul>
</li>
<li>请求体<ul>
<li>请求体，用于提交Post请求提交的数据；最后一个请求头和请求体之间存在一个空行</li>
</ul>
</li>
</ul>
<p>###HTTP响应    </p>
<pre><code>- 格式：响应行，响应头，响应体
</code></pre><ol>
<li>响应行<ul>
<li>格式：  协议/格式  响应码  </li>
<li>例如：  HTTP/1.1 200    OK</li>
</ul>
</li>
<li>响应头<ul>
<li>Server: nginx/1.6.0     – 服务器型号</li>
<li>Date: Mon, 27 Jun 2016 05:51:06 GMT –时间</li>
<li>Content-Type: application/json;charset=UTF-8 –数据类型</li>
<li>Transfer-Encoding: chunked</li>
<li>Connection: keep-alive 连接状态</li>
<li>Access-Control-Allow-Origin: *</li>
</ul>
</li>
<li>响应体<ul>
<li>返回我们需要的数据，比如我们经常拿到的json或者xml等等</li>
</ul>
</li>
</ol>
<hr>
<p>###Tips</p>
<ol>
<li>将字符串的#rgb转成color资源<ul>
<li>Color.parseColor(String)</li>
<li><img src="http://i.imgur.com/qL3WyLY.png" alt=""></li>
</ul>
</li>
<li>Android TextView中可以设置html代码<ul>
<li><img src="http://i.imgur.com/XY0qSNS.png" alt=""></li>
<li><img src="http://i.imgur.com/ojqKnRE.png" alt=""></li>
</ul>
</li>
<li>OKHttp工具类的封装<ul>
<li><img src="http://i.imgur.com/ec1Vykw.png" alt=""></li>
</ul>
</li>
<li>复习接口回调<ul>
<li><img src="http://i.imgur.com/fCipI12.png" alt=""></li>
</ul>
</li>
<li>复习Handler<ul>
<li><img src="http://i.imgur.com/I0BYrEE.png" alt=""></li>
<li><img src="http://i.imgur.com/O8BaNeG.png" alt=""></li>
</ul>
</li>
<li>Map遍历foreach（需要的数据类型：数据源map.entrySet()）</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">JamesWong</p>
              <p class="site-description motion-element" itemprop="description">简单即快乐。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">85</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JamesWong</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
